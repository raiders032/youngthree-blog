---
title: "CAP 이론으로 알아보는 분산 데이터베이스 시스템의 핵심 개념"
description: "분산 데이터베이스 시스템의 근간이 되는 CAP 이론에 대해 알아봅니다. 일관성(Consistency), 가용성(Availability), 파티션 내성(Partition Tolerance)의 개념과 실제 데이터베이스 선택 시 고려해야 할 사항들을 다룹니다."
tags: [ "DATABASE", "DISTRIBUTED_SYSTEM", "SYSTEM_DESIGN", "COMPUTER_SCIENCE" ]
keywords: [ "CAP 이론", "CAP Theorem", "캡이론", "분산 데이터베이스", "distributed database", "일관성", "consistency", "가용성", "availability", "파티션 내성", "partition tolerance", "데이터베이스 설계", "시스템 설계", "system design", "NoSQL", "RDBMS" ]
draft: false
hide_title: true
---

## 1. CAP 이론 소개

- CAP 이론은 분산 데이터베이스 시스템에서 동시에 만족할 수 없는 세 가지 특성을 설명하는 이론입니다.
- 2000년 Eric Brewer가 제안한 이 이론은 현대 분산 시스템 설계의 근간이 되고 있습니다.

:::note[CAP 이론의 핵심]
분산 시스템에서는 네트워크 파티션이 발생했을 때, 일관성과 가용성 중 하나를 선택해야 합니다. 세 가지 특성을 모두 완벽하게 만족하는 것은 불가능합니다.
:::

## 2. CAP의 세 가지 특성 상세 설명

### 2.1 일관성(Consistency)

#### 일관성이란?

- 일관성은 모든 읽기 작업이 가장 최근에 쓰여진 데이터를 반환해야 한다는 특성입니다.
- 즉, 분산된 모든 노드가 동일한 시점에 동일한 데이터를 보여줘야 합니다.
- 네트워크 파티션이 발생했을 때 일부 노드가 서로 통실한 수 없는 상태에서 모든 노드는 동일한 데이터를 보장해야 합니다.
- 이는 어떤 노드가 요청을 처리하더라도 그 결과가 다른 노드와 충돌하지 않도록 하라는 것입니다. 
- 일관성을 우선시하면 일부 노드가 사용자 요청을 처리할 수 없게 됩니다.

#### 일관성의 단계

1. **강한 일관성(Strong Consistency)**
	- 모든 읽기는 가장 최근의 쓰기를 반영
	- 은행 거래와 같이 정확성이 중요한 시스템에서 필요
	- 성능 저하와 지연이 발생할 수 있음
2. **약한 일관성(Weak Consistency)**
	- 읽기가 최신 쓰기를 반영하지 않을 수 있음
	- 더 빠른 응답 시간 제공
	- SNS 피드와 같이 실시간성이 중요한 경우에 적합
3. **결과적 일관성(Eventual Consistency)**
	- 일정 시간이 지나면 모든 노드가 동일한 데이터를 가짐
	- 약한 일관성의 특별한 형태
	- DNS 시스템이 대표적인 예시

:::info[일관성 확보를 위한 전략]

- Primary-Secondary 복제 구조 사용
- 쿼럼(Quorum) 기반의 읽기/쓰기
- 버전 관리를 통한 충돌 해결

:::

### 2.2 가용성(Availability)

#### 가용성이란?

- 가용성은 모든 요청이 성공 또는 실패에 대한 응답을 받아야 한다는 특성입니다.
- 즉, 시스템에 요청을 보내면 무조건 응답을 받을 수 있어야 합니다.
- 네트워크 파티션이 발생했을 때 가능한 많은 노드가 요청을 처리할 수 있도록 보장하는 것입니다. 
- 이 경우 서로 다른 데이터 상태를 유지할 수 있으며 사용자는 시스템의 각 노드에 접근할 수 있습니다. 
- 가용성을 우선시하는 경우 각 노드는 독립적으로 운영되어 데이터 일관성이 보장되지 않을 수 있습니다.

#### 가용성의 수준

1. **고가용성(High Availability)**
   - 99.999% 이상의 가용성 보장
   - 연간 5분 이내의 다운타임 허용
   - 금융 시스템, 응급 서비스에서 필요
2. **적정 가용성(Moderate Availability)**
   - 99.9% 정도의 가용성
   - 연간 8.76시간의 다운타임 허용
   - 일반적인 웹 서비스에 적합

:::warning[가용성과 신뢰성의 차이]

가용성은 시스템이 동작 중인 시간의 비율을 의미하며, 신뢰성은 시스템이 정상적으로 동작하는 정도를 의미합니다. 높은 가용성이 반드시 높은 신뢰성을 보장하지는 않습니다.

:::

### 2.3 파티션 내성(Partition Tolerance)

#### 파티션 내성이란?

- 네트워크 파티션(분할)이 발생하더라도 시스템이 계속 동작해야 한다는 특성입니다.
- 네트워크 파티션은 분산 시스템에서 노드 간 통신이 실패하는 상황을 의미합니다.
- 분산 시스템처럼 여러 노드가 분산되어 있거나 인터넷에 의존하는 시스템에서는 네트워크 파티션이 발생하는 것을 막을 수 없습니다.
  - 따라서 분산 시스템에서는 네트워크 파티션이 발생했을 때, 일관성과 가용성 중 하나를 선택해야 합니다. 
  - 세 가지 특성을 모두 완벽하게 만족하는 것은 불가능합니다.

#### 네트워크 파티션의 유형

1. **완전 단절**
   - 특정 노드나 노드 그룹이 다른 노드들과 완전히 통신이 끊김
   - 예: 데이터센터 간 네트워크 케이블 손상
2. **부분 단절**
   - 일부 메시지만 전달되거나 극심한 지연 발생
   - 예: 네트워크 혼잡, 일시적인 연결 불안정
3. **비대칭 파티션**
   - A노드→B노드 통신은 가능하지만, B노드→A노드 통신은 불가능한 상황
   - 예: 방화벽 설정 오류, 라우팅 문제

## 3. 실제 데이터베이스의 CAP 특성

### 3.1 CP 시스템 (일관성 + 파티션 내성)

#### 특징

- 네트워크 파티션 발생 시 가용성 포기
- 모든 노드가 동일한 데이터를 보여줌
- 일부 노드 응답 불가 시 전체 시스템 중단 가능성

#### 대표적인 CP 데이터베이스

- MongoDB (설정에 따라 CP 또는 AP)
- HBase
- Redis (단일 마스터 설정 시)

#### 적합한 사용 사례

- 금융 거래 시스템
- 재고 관리 시스템
- 예약 시스템
- 결제 시스템

### 3.2 AP 시스템 (가용성 + 파티션 내성)

#### 특징

- 네트워크 파티션 발생 시 일관성 포기
- 항상 응답 가능
- 일시적으로 노드 간 데이터 불일치 허용

#### 대표적인 AP 데이터베이스

- Cassandra
- CouchDB
- DynamoDB (기본 설정)

#### 적합한 사용 사례

- 소셜 미디어 피드
- 로그 수집 시스템
- 추천 시스템
- 실시간 분석 시스템

## 4. CAP 이론을 고려한 시스템 설계

### 4.1 선택 기준

1. **데이터 특성 분석**
   - 데이터의 중요도
   - 업데이트 빈도
   - 읽기/쓰기 비율
2. **비즈니스 요구사항**
   - 서비스 레벨 협약(SLA)
   - 법적 규제 요구사항
   - 사용자 경험 요구사항
3. **운영 환경**
   - 지리적 분산 정도
   - 네트워크 안정성
   - 하드웨어 인프라

### 4.2 하이브리드 접근

:::info[다중 데이터베이스 활용]
현대 시스템에서는 단일 데이터베이스에 의존하지 않고, 각 데이터의 특성에 맞는 다양한 데이터베이스를 조합하여 사용합니다.
:::

#### 일반적인 구성

- **핵심 트랜잭션용 DB**
	- CP 특성의 RDBMS
	- 강한 일관성 보장
- **캐시 레이어**
	- Redis/Memcached
	- 빠른 읽기 성능
- **분석용 DB**
	- AP 특성의 NoSQL
	- 대용량 데이터 처리

## 5. 결론

- CAP 이론은 분산 시스템 설계의 근본적인 제약사항을 이해하는 데 매우 중요한 개념입니다.
- 하지만 실제 시스템 설계에서는 이를 절대적인 규칙이 아닌 가이드라인으로 활용해야 합니다.

:::tip[실용적 접근]
현대의 데이터베이스 시스템들은 CAP의 세 가지 특성을 상황에 따라 유연하게 조절할 수 있는 기능을 제공합니다. 특정 상황에서 어떤 특성을 우선시할지 결정하는 것이 중요합니다.
:::
## 1 IAM

- AWS Identity and Access Management(IAM)은 AWS 리소스에 대한 액세스를 안전하게 제어할 수 있는 웹 서비스입니다. 
- 이를 통해 사용자는 AWS 리소스에 대한 접근 권한을 중앙에서 관리할 수 있으며, 사용자의 인증(로그인) 및 권한 부여(접근 권한)를 세밀하게 제어할 수 있습니다.



## 2 주요 구성 요소

### 2.1 루트 계정(Root Account)

- AWS 계정을 생성할 때 만들어지는 루트 계정은 모든 AWS 리소스에 대한 전체 액세스 권한을 가지고 있습니다.
- 최고 관리자 권한을 가지고 있기 때문에, 보안을 위해 필수적인 작업 외에는 루트 계정 사용을 자제해야 합니다.



### 2.2 사용자(User)

- User는 AWS Management Console, CLI, SDK 등을 통해 AWS 리소스에 접근하는 사람이나 애플리케이션을 의미합니다.
- 사용자는 고유한 자격 증명(Access Key, Secret Access Key, 비밀번호 등)을 가집니다.
- 각 사용자는 고유한 식별 정보(ID) 및 관련 권한을 가지며, 이를 통해 AWS 리소스에 대한 액세스를 안전하게 제어할 수 있습니다.
- 사용자는 하나 이상의 그룹에 소속되거나 독립적으로 존재할 수 있습니다.



 **루트 유저 대신 유저를 만들어야 하는 이유**
 
- **보안 강화**
    - 루트 계정은 모든 리소스에 대한 무제한 접근 권한을 가지므로, 이를 사용하면 보안 위험이 증가합니다.
    - 사용자를 생성하고 필요한 최소 권한만 부여함으로써, 보안 사고 발생 시 피해를 최소화할 수 있습니다.
- **권한 관리의 용이성**
    - 루트 계정은 단일 계정으로 모든 권한을 관리하기 어렵습니다.
    - 사용자를 그룹으로 묶어 권한을 부여하면, 각 그룹의 역할에 맞게 효율적으로 권한을 관리할 수 있습니다.
- **추적 가능성**
    - 개별 사용자는 고유한 자격 증명을 가지므로, 누가 어떤 작업을 수행했는지 추적하기 용이합니다.
    - 감사 로그를 통해 각 사용자의 활동을 기록하고 분석할 수 있습니다.
- **최소 권한 원칙 적용**
    - 루트 계정 사용을 지양하고 각 사용자에게 필요한 최소 권한만 부여함으로써, 불필요한 권한 남용을 방지할 수 있습니다.
    - 최소 권한 원칙은 보안 모범 사례 중 하나로, 시스템의 안전성을 높이는 데 기여합니다.



### 2.3 그룹(Group)

- 여러 사용자를 하나의 그룹으로 묶어 권한을 관리할 수 있습니다.
- 그룹은 사용자만 포함하며 다른 그룹을 포함할 수 없습니다.
- 예를 들어, "개발자" 그룹에는 AWS 리소스를 생성하고 관리할 수 있는 권한을 부여할 수 있습니다.



### 2.4 역할(Role)

- 사용자, 애플리케이션, 서비스가 일시적으로 할당받을 수 있는 권한 집합입니다.
- 역할을 사용하면 자격 증명을 공유하지 않고도 안전하게 권한을 위임할 수 있습니다.
- 예를 들어, EC2 인스턴스에 역할을 할당하여 그 인스턴스가 S3 버킷에 접근할 수 있게 할 수 있습니다.



#### 2.4.1 역할의 구성 요소

- **권한 정책 (Permission Policy)**:
    - 역할이 AWS 리소스에 대해 수행할 수 있는 작업을 정의합니다.
    - 여러 개의 권한 정책을 하나의 역할에 연결할 수 있습니다.
- **신뢰 정책 (Trust Policy)**:
    - 어떤 엔티티(AWS 서비스, 다른 AWS 계정, 외부 ID 공급자 등)가 이 역할을 맡을 수 있는지를 정의합니다.
    - 각 역할은 하나의 신뢰 정책만을 가질 수 있습니다.



### 2.5 권한(Policy)

- JSON 형식의 문서로, 사용자나 그룹에게 특정 리소스에 대한 액세스 권한을 부여하거나 거부합니다.
- 사용자(User) 혹은 그룹(Group) 에게 직접 권한를 할당할 수 있습니다.



![[Pasted image 20240223110209.png]]

- AWS Identity and Access Management(IAM)에서는 이미 만들어진 관리형 정책(managed policies)을 제공하며, 사용자가 필요에 따라 자신만의 사용자 정의 정책(custom policies)을 만들어 사용할 수도 있습니다.



**AdministratorAccess Policy**

```json
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": "*",
            "Resource": "*"
        }
    ]
}
```

- 이 예시에서는 해당 정책이 적용된 사용자나 그룹에게 AWS의 모든 리소스에 대한 액세스를 허용합니다.
- Effect: 권한 효과를 지정합니다. "Allow" 또는 "Deny"가 될 수 있으며, "Allow"는 특정 작업을 허용하고, "Deny"는 특정 작업을 명시적으로 거부합니다.
- Action: 수행할 수 있는 작업 또는 작업 집합을 지정합니다. `*`는 모든 작업을 의미합니다.
- Resource: 정책이 적용되는 리소스를 지정합니다. `*`는 모든 리소스를 의미합니다.



## 3 Policy의 구조

### 3.1 Version

- **Version 요소는 정책의 버전을 지정합니다.**
- 현재 AWS에서는 "2012-10-17" 버전을 사용합니다.
- 정책의 버전은 정책의 구문과 기능을 정의하는데 중요합니다.



### 3.2 Id

- **Id 요소는 정책을 식별하는 선택적 요소입니다.**
- 정책을 명확하게 식별하기 위해 고유한 ID를 사용할 수 있습니다.
- 정책 ID는 정책을 추적하거나 관리하는 데 유용합니다.



### 3.3 Statement

- **Statement 요소는 정책의 주요 부분으로, 각 명령문은 허용 또는 거부할 작업과 리소스를 정의합니다.**
- 하나의 정책에는 여러 개의 명령문을 포함할 수 있으며, 각 명령문은 독립적으로 평가됩니다.



#### 3.3.1 Effect

- Effect 요소는 필수 항목이며, 명령문이 허용(allow)인지 명시적 거부(deny)인지 지정합니다.
- Effect의 유효한 값은 Allow와 Deny입니다.
- Effect 값은 대소문자를 구분합니다.
- 본적으로 리소스에 대한 접근은 거부됩니다. 
	- 리소스에 대한 접근을 허용하려면 Effect 요소를 Allow로 설정해야 합니다.
- 허용을 무효화하려면(예: 이미 적용된 허용을 무효화하려는 경우), Effect 요소를 Deny로 설정합니다.



#### 3.3.2 Action

- Action 요소는 허용하거나 거부할 특정 작업을 설명합니다.
- 명령문에는 Action 또는 NotAction 요소가 포함되어야 합니다.
- 각 AWS 서비스에는 해당 서비스로 수행할 수 있는 작업을 설명하는 고유한 작업 집합이 있습니다..
- 값은 서비스 네임스페이스(예: iam, ec2, sqs, sns, s3 등)를 작업 접두사로 사용하고 그 뒤에 허용하거나 거부할 작업 이름을 지정합니다.
- 접두사와 작업 이름은 대소문자를 구분하지 않습니다.
    - 예를 들어, `iam`과 `IAM`은 동일합니다.
- `*` 기호를 사용하여 모든 작업을 지정할 수 있으며, 특정 네임스페이스에 대한 모든 작업을 지정하려면 `서비스명:*` 형식을 사용할 수 있습니다.
- `get*`와 같은 와일드카드를 사용하면 특정 패턴을 따르는 모든 작업을 포함할 수 있습니다.



**예시**

```
"Action": [
    "sqs:SendMessage",
    "sqs:ReceiveMessage",
    "ec2:StartInstances",
    "iam:ChangePassword",
    "s3:GetObject"
]
```



#### 3.3.3 Resource

- Resource 요소는 명령문이 적용되는 객체를 지정합니다.
- 명령문에는 Resource 또는 NotResource 요소가 포함되어야 합니다.
- 리소스는 ARN을 사용하여 지정합니다. 
	- ARN의 형식에 대한 자세한 내용은[IAM ARNs](https://docs.aws.amazon.com/ko_kr/IAM/latest/UserGuide/reference_identifiers.html)를 참조



#### 3.3.4 Condition

- Condition 요소는 특정 조건이 충족될 때만 명령문이 적용되도록 설정할 수 있습니다.
- 조건은 키-값 쌍으로 구성되며, 여러 조건을 결합하여 복잡한 조건을 설정할 수 있습니다.
- 조건 연산자는 조건을 평가하는 방법을 정의합니다. 
- 예를 들어, StringEquals, NumericLessThan, Bool 등이 있습니다



#### 3.3.5 Principal

- Principal 은 AWS 리소스에 액세스하는 주체(사용자, 그룹, 역할, 서비스 등)를 나타냅니다.
- IAM 정책에서 Principal 요소는 액세스 권한을 부여할 주체를 지정하는 데 사용됩니다.



## 4 Password Policy

### 4.1 개요

- AWS IAM 패스워드 정책은 AWS 계정의 사용자들이 사용하는 비밀번호의 보안 수준을 설정하는 데 사용됩니다.
- 강력한 패스워드 정책을 설정함으로써 계정 보안을 강화하고, 무단 접근을 방지할 수 있습니다.



### 4.2 주요 구성 요소

#### 4.2.1 최소 비밀번호 길이

- 최소 비밀번호 길이는 비밀번호가 가져야 할 최소 문자 수를 정의합니다.
- 보안 강화를 위해 일반적으로 8자 이상의 길이를 권장합니다.



#### 4.2.2 비밀번호 복잡성 요구사항

- 비밀번호에 포함되어야 하는 문자 유형을 설정할 수 있습니다.
    - **대문자:** 최소 하나 이상의 대문자를 포함해야 합니다.
    - **소문자:** 최소 하나 이상의 소문자를 포함해야 합니다.
    - **숫자:** 최소 하나 이상의 숫자를 포함해야 합니다.
    - **특수 문자:** 최소 하나 이상의 특수 문자를 포함해야 합니다. (!, @, #, $, %, ^, &, * 등)



#### 4.2.3 비밀번호 재사용 금지

- 이전에 사용한 비밀번호를 다시 사용할 수 없도록 제한합니다.
- 설정된 횟수만큼 이전 비밀번호를 기억하고, 해당 비밀번호로 변경할 수 없도록 합니다.
- 예를 들어, 마지막 5개의 비밀번호를 기억하도록 설정하면, 사용자는 마지막 5개의 비밀번호를 다시 사용할 수 없습니다.



#### 4.2.4 비밀번호 만료

- 비밀번호의 유효 기간을 설정하여, 정기적으로 비밀번호를 변경하도록 강제할 수 있습니다.
- 유효 기간을 90일로 설정하면, 사용자는 90일마다 비밀번호를 변경해야 합니다.



#### 4.2.5 비밀번호 만료 경고

- 비밀번호 만료 전 사용자에게 경고를 보내어, 비밀번호를 미리 변경할 수 있도록 합니다.
- 예를 들어, 만료 7일 전에 경고를 보내도록 설정할 수 있습니다.



#### 4.2.6 비밀번호 변경 요구사항

- 처음 로그인하거나 임시 비밀번호로 로그인할 때, 사용자가 비밀번호를 변경하도록 요구할 수 있습니다.
- 이는 보안성을 높이는 데 도움을 줍니다.



## 5 MFA

### 5.1 개요

- MFA(Multi-Factor Authentication)는 AWS 계정 보안을 강화하기 위해 두 가지 이상의 인증 요소를 요구하는 방법입니다.
- 기본적인 비밀번호 외에 추가적인 인증 수단을 사용하여 보안을 크게 향상시킬 수 있습니다.



### 5.2 MFA 구성 요소

#### 5.2.1 인증 요소

- **첫 번째 요소:** 사용자 이름과 비밀번호.
- **두 번째 요소:** SMS, OTP(일회용 비밀번호) 생성기 또는 하드웨어 MFA 장치.



#### 5.2.2 MFA 장치 유형

- **가상 MFA 장치:** 스마트폰 앱(예: Google Authenticator, Authy)을 사용하여 MFA 코드를 생성합니다.
- **SMS MFA:** 사용자의 휴대폰으로 SMS를 통해 MFA 코드를 전송합니다.
- **하드웨어 MFA 장치:** YubiKey와 같은 물리적 장치를 사용하여 MFA를 구현합니다.



## 6 Access Key

- IAM 액세스 키는 AWS CLI, SDK, API를 통해 AWS 서비스에 대한 프로그래밍 방식의 액세스를 허용하는 자격 증명입니다.
- 액세스 키는 액세스 키 ID와 비밀 액세스 키로 구성됩니다.



### 6.1 액세스 키 관리

#### 6.1.1 액세스 키 생성

- IAM 콘솔에서 액세스 키를 생성할 수 있습니다.
- 액세스 키 생성 시, 비밀 액세스 키는 한 번만 제공되므로 안전한 장소에 저장해야 합니다.



#### 6.1.2 액세스 키 비활성화 및 삭제

- 사용하지 않는 액세스 키는 보안 강화를 위해 비활성화하거나 삭제해야 합니다.
- IAM 콘솔이나 AWS CLI를 통해 액세스 키를 비활성화 또는 삭제할 수 있습니다.



#### 6.1.3 액세스 키 로테이션

- 보안 모범 사례로, 정기적으로 액세스 키를 회전하여 새로운 키로 교체해야 합니다.
- 액세스 키 로테이션을 통해 잠재적인 보안 위험을 줄일 수 있습니다.
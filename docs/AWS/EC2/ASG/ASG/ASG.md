## 1 Amazon EC2 Auto Scaling

- Amazon EC2 Auto Scaling은 애플리케이션의 부하를 처리할 수 있도록 적절한 수의 Amazon EC2 인스턴스를 자동으로 확보해 줍니다. 
- 이를 위해 Auto Scaling 그룹이라는 EC2 인스턴스 모음을 생성합니다. 
- 각 Auto Scaling 그룹에는 최소 인스턴스 수와 최대 인스턴스 수를 지정할 수 있습니다. 
- Amazon EC2 Auto Scaling은 지정한 최소 인스턴스 수 아래로 인스턴스 수가 내려가지 않도록 보장하며, 최대 인스턴스 수를 초과하지 않도록 조절합니다.



## 2 주요 기능

### 2.1 인스턴스 상태 모니터링

- Amazon EC2 Auto Scaling은 EC2 헬스 체크를 통해 실행 중인 인스턴스의 상태와 가용성을 자동으로 모니터링합니다.
- 상태가 불량한 인스턴스를 감지하여 자동으로 교체함으로써 원하는 용량을 유지합니다.



### 2.2 커스텀 헬스 체크

- 기본 내장 헬스 체크 외에도, 애플리케이션의 특정 요구에 맞는 커스텀 헬스 체크를 정의할 수 있습니다.
- 커스텀 헬스 체크를 통과하지 못한 인스턴스는 자동으로 교체되어 원하는 용량을 유지합니다.



### 2.3 가용 영역 간 용량 균형

- 여러 가용 영역을 지정하여 Auto Scaling 그룹이 확장됨에 따라 인스턴스를 균등하게 분배할 수 있습니다.
- 이를 통해 단일 위치의 장애로부터 애플리케이션을 보호하여 고가용성과 복원력을 제공합니다.



### 2.4 다양한 인스턴스 유형 및 구매 옵션

- 단일 Auto Scaling 그룹 내에서 여러 인스턴스 유형 및 구매 옵션(Spot 및 On-Demand 인스턴스)을 사용할 수 있습니다.
- Spot 인스턴스 사용을 통해 비용을 최적화할 수 있으며, 예약 인스턴스와 절약 플랜을 함께 사용하여 비용을 절감할 수 있습니다.



### 2.5 자동 Spot 인스턴스 교체

- Auto Scaling 그룹에 Spot 인스턴스가 포함된 경우, Spot 인스턴스가 중단될 때 자동으로 대체 용량을 요청할 수 있습니다.
- 용량 재조정을 통해 중단 위험이 높은 Spot 인스턴스를 모니터링하고 사전에 교체할 수 있습니다.



### 2.6 로드 밸런싱

- Elastic Load Balancing을 사용하여 애플리케이션 트래픽을 건강한 인스턴스에 고르게 분배할 수 있습니다.
- 인스턴스가 시작되거나 종료될 때 Auto Scaling이 자동으로 로드 밸런서에 인스턴스를 등록 및 등록 해제합니다.



### 2.7 확장성

- Auto Scaling을 통해 피크 부하를 처리하기 위해 용량을 추가하고 수요가 낮을 때 용량을 줄여 애플리케이션 가용성을 유지하고 비용을 절감할 수 있습니다.
- 필요에 따라 Auto Scaling 그룹의 크기를 수동으로 조정할 수도 있습니다.



### 2.8 인스턴스 갱신

- 인스턴스 갱신 기능을 통해 AMI 또는 시작 템플릿을 업데이트할 때 인스턴스를 순차적으로 업데이트할 수 있습니다.
- 새로운 AMI 또는 시작 템플릿을 소규모 인스턴스 집합에서 테스트한 후 전체 그룹에 롤아웃할 수 있는 단계적 접근 방식을 사용할 수 있습니다.



### 2.9 라이프사이클 훅

- 새로운 인스턴스가 시작될 때 또는 인스턴스가 종료되기 전에 커스텀 작업을 정의할 수 있는 라이프사이클 훅을 제공합니다.
- 이벤트 중심 아키텍처를 구축하는 데 유용하며, 인스턴스의 생명주기 동안 인스턴스를 관리하는 데 도움을 줍니다.



### 2.10 상태 저장 워크로드 지원

- 종료 시 상태를 지속시키기 위한 메커니즘을 제공하는 라이프사이클 훅을 제공합니다.
- 상태 저장 애플리케이션의 연속성을 보장하기 위해 긴 실행 프로세스를 가진 인스턴스가 일찍 종료되지 않도록 보호할 수 있습니다.



### 2.11 스케일링 방법

- Amazon EC2 Auto Scaling은 다양한 스케일링 정책을 통해 애플리케이션의 가용성과 성능을 보장합니다
- [[ScalingMethod]] 참고



## 3 요금

- Amazon EC2 Auto Scaling은 추가 요금이 부과되지 않으며, 사용한 AWS 리소스(예: EC2 인스턴스, EBS 볼륨, CloudWatch 알람)에 대해서만 요금을 지불합니다.
- 이를 통해 비용 효율적으로 Auto Scaling을 도입하고 AWS 아키텍처의 이점을 확인할 수 있습니다.



## 4 라이프 사이클 훅

- 라이프 사이클 훅(Lifecycle Hooks)은 Amazon EC2 Auto Scaling에서 제공하는 기능으로, 인스턴스가 시작되거나 종료될 때 사용자 정의 작업을 수행할 수 있게 해줍니다.
- 이를 통해 인스턴스의 상태 변화에 따라 자동화된 작업을 실행할 수 있어 애플리케이션의 복잡한 요구 사항을 충족할 수 있습니다.



### 4.1 라이프 사이클 훅의 개념

- **Lifecycle Hook**은 Auto Scaling 그룹에서 인스턴스가 시작 또는 종료되는 시점에 실행되는 스크립트 또는 명령입니다.
- 이 훅을 사용하면 인스턴스가 완전히 시작되기 전 또는 종료되기 전 특정 작업을 수행할 수 있습니다.
- 라이프 사이클 훅은 인스턴스의 상태를 `Pending:Wait` 또는 `Terminating:Wait`로 변경하여 사용자 정의 작업을 완료할 때까지 인스턴스 상태를 일시적으로 중지시킵니다.



### 4.2 라이프 사이클 훅의 활용

- **인스턴스 초기화**: 인스턴스 시작 시 필요한 설정이나 초기화 작업을 수행할 수 있습니다.
- **데이터 백업**: 인스턴스 종료 전 데이터를 백업하거나 상태를 저장할 수 있습니다.
- **모니터링 및 로그 수집**: 인스턴스가 종료되기 전 로그 데이터를 수집하고 모니터링 시스템에 전송할 수 있습니다.
- **애플리케이션 종료 작업**: 애플리케이션의 정상적인 종료 작업을 수행하여 데이터 손실을 방지할 수 있습니다.



### 4.3 라이프 사이클 훅 구성

- **Lifecycle Hook 생성**: Auto Scaling 그룹을 생성하거나 업데이트할 때 라이프 사이클 훅을 정의할 수 있습니다.
- **S3 또는 SNS 통합**: 라이프 사이클 훅이 트리거될 때 알림을 전송하거나 데이터를 저장할 수 있도록 S3 또는 SNS와 통합할 수 있습니다.
- **대기 시간 설정**: 라이프 사이클 훅이 실행되는 동안 대기 시간을 설정할 수 있습니다. 기본 대기 시간은 3600초(1시간)입니다.



### 4.4 라이프 사이클 훅 종료

- **Continue**: 라이프 사이클 훅 작업이 완료되면 인스턴스가 다음 상태로 전환됩니다. 예를 들어, `Pending:Wait` 상태의 인스턴스는 `InService` 상태로 전환됩니다.
- **Abandon**: 인스턴스를 종료하거나 시작을 취소할 수 있습니다. 예를 들어, `Terminating:Wait` 상태의 인스턴스는 즉시 종료됩니다.



### 4.5 활용 사례

- **애플리케이션 배포**: 새로운 인스턴스가 시작될 때 애플리케이션을 자동으로 배포하고 설정할 수 있습니다.
- **데이터 동기화**: 종료되는 인스턴스의 데이터를 다른 저장소로 동기화하여 데이터 손실을 방지할 수 있습니다.
- **자동화된 인프라 관리**: 인스턴스 상태 변화에 따라 다양한 인프라 관리 작업을 자동화할 수 있습니다.



### 4.6 라이프 사이클 훅의 이점

- **자동화**: 인스턴스의 생명주기에 따른 자동화된 작업을 통해 운영 효율성을 높일 수 있습니다.
- **유연성**: 다양한 커스텀 작업을 수행할 수 있어 애플리케이션 요구 사항에 맞는 유연한 설정이 가능합니다.
- **신뢰성**: 인스턴스 시작 및 종료 시 중요한 작업을 자동으로 처리하여 애플리케이션의 안정성과 신뢰성을 향상시킵니다.



## 5 Scaling Cooldowns

- **Scaling Cooldowns**는 Amazon EC2 Auto Scaling의 중요한 기능으로, 인스턴스가 추가되거나 제거된 후 일정 기간 동안 Auto Scaling 그룹이 추가적인 스케일링 작업을 수행하지 않도록 하는 기간을 말합니다.
- 이 기능은 과도한 스케일링 이벤트를 방지하고, Auto Scaling 그룹의 안정성을 유지하는 데 도움을 줍니다.



### 5.1 기본 개념

- **목적**: 스케일링 쿨다운 기간은 Auto Scaling 그룹이 인스턴스를 추가하거나 제거한 후, 그 영향을 확인하고 시스템을 안정화하는 데 필요한 시간을 제공하기 위해 존재합니다.
- **기본 쿨다운 시간**: 기본적으로, Auto Scaling 그룹은 300초(5분)의 쿨다운 시간을 설정합니다. 이 시간 동안 추가적인 스케일링 이벤트는 발생하지 않습니다.



### 5.2 스케일링 쿨다운의 작동 방식

- **인스턴스 추가/제거 후 대기**: 인스턴스가 추가되거나 제거된 후, 설정된 쿨다운 시간이 경과할 때까지 Auto Scaling 그룹은 새로운 스케일링 조정을 수행하지 않습니다.
- **시스템 안정화**: 쿨다운 시간 동안, Auto Scaling 그룹은 새로운 인스턴스의 시작 또는 기존 인스턴스의 종료로 인한 시스템 변화에 적응할 수 있는 시간을 가집니다. 이는 트래픽 증가 또는 감소에 따른 과도한 인스턴스 수 변동을 방지하는 데 도움을 줍니다.



### 5.3 스케일링 쿨다운 설정

- **개별 정책 쿨다운**: Auto Scaling 그룹의 각 스케일링 정책에 대해 개별적인 쿨다운 시간을 설정할 수 있습니다. 예를 들어, 급격한 트래픽 증가에 대비한 스케일 아웃 정책에는 짧은 쿨다운 시간을, 스케일 인 정책에는 긴 쿨다운 시간을 설정할 수 있습니다.
- **스케일 인/아웃 구분**: 스케일 아웃과 스케일 인에 각각 다른 쿨다운 시간을 설정하여, 특정 상황에 맞춘 유연한 스케일링 전략을 수립할 수 있습니다.



### 5.4 스케일링 쿨다운의 이점

- **자원 낭비 방지**: 과도한 스케일링 이벤트를 줄여 인스턴스 시작과 종료로 인한 자원 낭비를 방지합니다.
- **시스템 안정성 확보**: 인스턴스가 시작되거나 종료된 후 시스템의 안정성을 확보하기 위해 필요한 시간을 제공합니다.
- **비용 절감**: 필요 이상의 인스턴스를 실행하는 것을 방지함으로써 비용을 절감할 수 있습니다.



### 5.5 쿨다운 조정의 필요성

- 특정 애플리케이션이나 워크로드의 특성에 따라 쿨다운 시간을 조정하는 것이 필요할 수 있습니다.
- 예를 들어, 애플리케이션의 초기화 시간이 길다면 더 긴 쿨다운 시간이 필요할 수 있습니다.
- 반대로, 신속한 트래픽 증가에 대응하기 위해 짧은 쿨다운 시간이 필요할 수도 있습니다.



## 6 Instance Refresh
    
- **Instance Refresh**는 Amazon EC2 Auto Scaling 그룹 내의 인스턴스를 주기적으로 업데이트하거나 교체하는 프로세스를 의미합니다.
- 이 기능을 사용하면 최신 AMI(Amazon Machine Image), 시작 템플릿, 또는 기타 구성 변경 사항을 기존 인스턴스에 적용할 수 있습니다.
- Instance Refresh를 통해 보안 패치 적용, 애플리케이션 업데이트, 인스턴스 유형 변경 등의 작업을 자동화하고, 인스턴스 상태를 최신으로 유지할 수 있습니다.
    



### 6.1 Instance Refresh의 주요 개념

- **AMI 및 시작 템플릿 업데이트**: 인스턴스 갱신은 새로운 AMI 또는 시작 템플릿을 사용하여 기존 인스턴스를 교체합니다. 이는 새로운 소프트웨어 버전, 보안 패치, 또는 인스턴스 설정을 배포하는 데 유용합니다.
- **롤링 업데이트**: Instance Refresh는 한 번에 전체 인스턴스를 교체하지 않고, 단계적으로 인스턴스를 업데이트합니다. 이를 통해 애플리케이션의 가용성을 유지하면서 점진적으로 변경 사항을 적용할 수 있습니다.
- **상태 확인 및 중단 방지**: 각 인스턴스 교체 시 상태 확인을 통해 새로운 인스턴스가 정상적으로 실행되는지 확인하며, 필요시 롤백할 수 있습니다. 이를 통해 애플리케이션의 가용성을 보장할 수 있습니다.



### 6.2 Instance Refresh 설정

- **Instance Refresh 시작**: AWS Management Console, AWS CLI, 또는 AWS SDK를 사용하여 Instance Refresh를 시작할 수 있습니다.
- **설정 파라미터**:
    - **최소 건강 비율**: 인스턴스 교체 중에 유지해야 할 최소한의 건강한 인스턴스 비율을 지정합니다.
    - **최대 배치 크기**: 한 번에 갱신할 인스턴스의 최대 수를 지정합니다. 이 값은 전체 인스턴스 수의 비율이나 정수로 설정할 수 있습니다.
    - **중지 조건**: 갱신 중 오류가 발생하면 프로세스를 중지하거나 롤백할 수 있습니다.



### 6.3 Instance Refresh의 이점

- **안정적인 업데이트**: Instance Refresh는 롤링 업데이트를 통해 애플리케이션의 가용성을 유지하면서 인스턴스를 안전하게 교체할 수 있습니다.
- **자동화된 유지 관리**: 새로운 AMI나 시작 템플릿으로 인스턴스를 자동으로 갱신하여 운영 효율성을 높일 수 있습니다.
- **보안 및 컴플라이언스**: 최신 보안 패치와 업데이트를 빠르게 적용하여 보안 상태를 강화할 수 있습니다.



### 6.4 사용 사례

- **보안 패치 배포**: 보안 취약점이 발견된 경우, 최신 패치를 포함한 AMI를 사용하여 인스턴스를 업데이트할 수 있습니다.
- **애플리케이션 업그레이드**: 애플리케이션의 새로운 버전을 배포할 때, Instance Refresh를 통해 최신 AMI를 배포할 수 있습니다.
- **리소스 최적화**: 인스턴스 유형 변경을 통해 비용 최적화 또는 성능 향상을 달성할 수 있습니다.
## 1 Amazon Route 53

- Amazon Route 53은 AWS의 클라우드 도메인 네임 시스템(DNS) 웹 서비스입니다.
- 이 서비스는 사용자가 도메인 이름을 등록하고, DNS 라우팅을 설정하며, 도메인 이름에 대한 헬스 체크를 수행할 수 있게 해줍니다.
- Route 53은 높은 가용성과 확장성을 제공하며, 전 세계의 사용자에게 안정적인 도메인 네임 해석 서비스를 제공합니다.

## 2 주요 기능

### 2.1 도메인 이름 등록

- Amazon Route 53은 도메인 이름을 등록하고 관리할 수 있는 기능을 제공합니다.
- 다양한 최상위 도메인(TLD)을 지원하며, 간편한 인터페이스를 통해 도메인을 등록할 수 있습니다.

### 2.2 DNS 라우팅

- Route 53은 여러 가지 라우팅 정책을 제공하여 사용자가 원하는 방식으로 트래픽을 분산시킬 수 있습니다.
	- 이는 트래픽을 라우팅하는 로드 밸런서의 라우팅과는 다릅니다.
	- DNS는 트래픽을 라우팅하지 않고, 단지 DNS 쿼리에 응답합니다.

**주요 라우팅 정책**

- **단순 라우팅(Simple Routing)**: 하나의 레코드에 대한 단순한 DNS 응답을 제공합니다.
- **지연 시간 기반 라우팅(Latency-Based Routing)**: 사용자와 가장 가까운 리전으로 트래픽을 라우팅하여 지연 시간을 최소화합니다.
- **장애 조치 라우팅(Failover Routing)**: 주 리소스가 실패할 경우 대체 리소스로 트래픽을 라우팅합니다.
- **가중치 기반 라우팅(Weighted Routing)**: 여러 리소스 간의 트래픽 비율을 설정하여 분산시킬 수 있습니다.
- **지리 위치 기반 라우팅(Geolocation Routing)**: 사용자의 위치에 따라 트래픽을 특정 리소스로 라우팅합니다.
- **지리 근접성 라우팅(Geoproximity Routing)**: 사용자의 지리적 위치와 리소스의 가중치를 기반으로 트래픽을 라우팅합니다.
- **멀티 값 응답 라우팅(Multi-Value Answer Routing)**: 여러 건강한 리소스를 반환하여 가용성을 높입니다.

### 2.3 헬스 체크 및 모니터링

- Route 53은 리소스의 상태를 모니터링할 수 있는 헬스 체크 기능을 제공합니다.
- 헬스 체크를 통해 리소스의 가용성을 확인하고, 비정상적인 리소스에 대한 트래픽을 자동으로 다른 리소스로 전환할 수 있습니다.

## 3 라우팅 정책

### 3.1 단순 라우팅 (Simple Routing)

- 단일 리소스로 트래픽을 라우팅합니다.
- 예를 들어, 하나의 웹 서버 IP 주소로 모든 요청을 보낼 때 사용합니다.
- 주로 트래픽을 단일 리소스로 라우팅합니다.
- 동일한 레코드에 여러 값을 지정할 수 있습니다.
- 여러 값이 반환되면 클라이언트가 무작위로 하나를 선택합니다.
- Alias가 활성화된 경우, 하나의 AWS 리소스만 지정할 수 있습니다.
- 헬스 체크와 연동할 수 없습니다.
- 사용 예시: `example.com` 도메인에 대한 단일 IP 주소를 반환합니다.

### 3.2 지연 시간 기반 라우팅 (Latency-Based Routing)

- 사용자가 가장 낮은 네트워크 지연 시간을 경험할 수 있는 리소스로 트래픽을 라우팅합니다.
- 글로벌 애플리케이션에서 사용자 경험을 최적화하는 데 유용합니다.
- **지연 시간 레코드 생성**
	- 여러 AWS 리전에 애플리케이션 리소스를 배포하고, 각 리전에 대해 지연 시간 레코드를 생성합니다.
	- 예를 들어, 미국 동부 리전과 아시아 태평양 리전에 웹 서버의 IP 주소에 대한 레코드를 생성합니다.
	- 하나의 도메인에 대해 여러 지연 시간 기반 라우팅 (Latency-Based Routing) 레코드를 생성할 수 있습니다.
		- 각 레코드는 다른 AWS 리전에 있는 리소스를 가리키게 됩니다.
		- 이렇게 하면 Route 53은 사용자의 위치와 가장 가까운 리전의 레코드를 선택하여 최적의 지연 시간을 제공하는 리소스로 트래픽을 라우팅합니다.
- **DNS 쿼리 처리**
	- Route 53은 사용자가 도메인(example.com) 또는 서브도메인(acme.example.com)에 대해 DNS 쿼리를 보낼 때 이를 처리합니다.
- **지연 시간 평가**
	- Route 53은 사용자의 위치와 설정된 리전들 간의 네트워크 지연 시간을 평가하여 최적의 리전을 선택합니다.
- **DNS 응답**
	- 가장 낮은 지연 시간을 제공하는 리전의 지연 시간 레코드 값을 사용자에게 반환합니다.
	- 예를 들어, 미국 동부 리전이 가장 낮은 지연 시간을 제공하면, 미국 동부 리전의 웹 서버 IP 주소를 반환합니다.
- **헬스 체크와 연동**
	- 각 리전에 배포된 리소스의 상태를 모니터링하기 위해 헬스 체크를 설정할 수 있습니다.
	- 헬스 체크가 실패한 리전은 지연 시간 평가에서 제외되어, 가용한 리전 중 가장 낮은 지연 시간을 제공하는 리전으로 트래픽이 라우팅됩니다.

### 3.3 장애 조치 라우팅 (Failover Routing)

- 장애 조치 라우팅(Failover Routing)은 주(primary) 리소스가 실패할 경우 트래픽을 백업(secondary) 리소스로 자동으로 전환하여 고가용성을 제공하는 라우팅 방법입니다.
- 이는 주로 중요한 애플리케이션이나 서비스의 가용성을 보장하기 위해 사용됩니다.

#### 3.3.1 Active-Passive 장애 조치

- **Active-Passive Failover**는 주(primary) 리소스가 활성 상태로 운영되고, 백업(secondary) 리소스는 대기 상태로 유지되는 방식입니다.
- 주 리소스에 장애가 발생하면 백업 리소스가 활성화되어 트래픽을 처리합니다.

**특징**

- **단일 활성 리소스**: 주 리소스만 트래픽을 처리하며, 백업 리소스는 대기 상태입니다.
- **장애 조치**: 주 리소스가 실패하면 백업 리소스가 활성화됩니다.
- **낮은 비용**: 백업 리소스는 대기 상태로 유지되므로 비용이 절감됩니다.

**설정 방법**

1. **헬스 체크 설정**: 주 리소스와 백업 리소스에 대해 헬스 체크를 설정합니다.
2. **DNS 레코드 설정**: 주 리소스와 백업 리소스에 대한 레코드를 생성하고, 각 레코드에 헬스 체크를 연결합니다.
3. **장애 조치 라우팅 정책 구성**: 주 리소스에 대해 "Primary" 레코드를, 백업 리소스에 대해 "Secondary" 레코드를 생성합니다.

**예시**

1. **기본 리소스와 보조 리소스 하나로 구성하기**
	- 기본 리소스가 비정상일 때만 보조 리소스가 트래픽을 처리합니다.
	- Route 53에서 기본(primary) 레코드와 보조(secondary) 레코드를 생성하고, 헬스 체크를 연결합니다.
2. **여러 기본 및 보조 리소스로 구성하기**
	- 기본 리소스와 보조 리소스 각각 여러 개를 설정할 수 있습니다.
	- Route 53은 모든 기본 리소스가 비정상일 때만 보조 리소스로 트래픽을 전환합니다.

#### 3.3.2 Active-Active 장애 조치

- **Active-Active Failover**는 Failover Routing 정책으로는 구현할 수 없으며, 다른 라우팅 정책을 사용하여 구현해야 합니다.
- 여러 리소스가 동시에 활성 상태로 운영되며, 트래픽을 분산하여 처리하는 방식입니다.
- 예를 들어, 지연 시간 기반 라우팅(Latency-Based Routing), 가중치 기반 라우팅(Weighted Routing), 또는 지리적 라우팅(Geolocation Routing)을 사용할 수 있습니다.

**특징**

- **동시 운영**: 모든 리소스가 동시에 활성 상태입니다.
- **부하 분산**: 트래픽이 여러 리소스에 분산됩니다.
- **높은 가용성**: 모든 리소스가 활성 상태이므로 가용성이 높습니다.
- **자동 장애 조치**: 하나의 리소스가 비정상일 경우, 다른 활성 리소스가 트래픽을 처리합니다.

**설정 방법**

1. **헬스 체크 설정**: 모든 활성 리소스에 대해 헬스 체크를 설정합니다.
2. **DNS 레코드 설정**: 동일한 이름과 유형을 가진 여러 레코드를 생성하고, 각 레코드에 헬스 체크를 연결합니다.
3. **라우팅 정책 선택**: 지연 시간 기반 라우팅, 가중치 기반 라우팅 등 다른 라우팅 정책을 사용하여 트래픽을 분산시킵니다.

#### 3.3.3 주요 차이점

- **운영 방식**: Active-Active는 여러 리소스가 동시에 운영되고, Active-Passive는 하나의 리소스만 운영되며 백업 리소스는 대기 상태입니다.
- **부하 분산**: Active-Active는 부하 분산을 통해 성능을 향상시키고, Active-Passive는 주로 재해 복구를 위해 사용됩니다.
- **비용**: Active-Passive는 대기 상태의 백업 리소스를 유지하기 때문에 비용이 낮지만, Active-Active는 모든 리소스가 활성 상태로 운영되기 때문에 비용이 높을 수 있습니다.
- **가용성**: Active-Active는 더 높은 가용성을 제공하며, Active-Passive는 주 리소스의 가용성이 낮아질 경우 백업 리소스로 전환됩니다.

### 3.4 가중치 기반 라우팅 (Weighted Routing)

- 여러 리소스 간에 트래픽을 가중치 비율에 따라 분산합니다.
- 트래픽 분산 테스트나 특정 리소스에 더 많은 트래픽을 보내야 할 때 유용합니다.
- 사용 예시: 두 개의 서버에 70%와 30% 비율로 트래픽을 분산합니다.
- 각 특정 리소스로 가는 요청의 %를 제어합니다.
- 각 레코드에 상대적인 가중치를 할당합니다:
	- 𝑡𝑟𝑎𝑓𝑓𝑖𝑐(%) = (해당 레코드의 가중치 / 모든 레코드의 가중치 합계) * 100
- 가중치의 합이 100이 될 필요는 없습니다.
- DNS 레코드는 동일한 이름과 유형을 가져야 합니다.
- 헬스 체크와 연계할 수 있습니다.
- 사용 사례: 리전 간 로드 밸런싱, 새로운 애플리케이션 버전 테스트 등
- 리소스로 트래픽을 보내지 않으려면 레코드의 가중치를 0으로 설정합니다.
- 모든 레코드의 가중치가 0이면, 모든 레코드가 동일하게 반환됩니다.

**A 레코드와 Weighted Routing의 차이점**

- **A 레코드 다중 IP**
	- 여러 IP 주소를 단일 A 레코드에 포함시킬 수 있습니다.
	- 클라이언트가 DNS 응답에서 IP 주소를 무작위로 선택하여 연결을 시도합니다.
	- 이는 클라이언트 측에서 무작위로 선택되므로, 서버 간의 트래픽 분산이 일관되지 않을 수 있습니다.
- **Weighted Routing**
	- 네임 서버가 트래픽을 가중치 비율에 따라 분산합니다.
	- 클라이언트 요청 시 네임 서버가 미리 정의된 가중치에 따라 하나의 IP 주소를 선택하여 응답합니다.
	- 서버 간의 트래픽 분산이 보다 일관되고 예측 가능합니다.

### 3.5 지리 위치 기반 라우팅 (Geolocation Routing)

- 사용자의 지리적 위치에 따라 트래픽을 특정 리소스로 라우팅합니다.
- 사용 예시: 특정 국가나 지역의 사용자를 지정된 리소스로 라우팅하여 지역별 맞춤형 콘텐츠를 제공합니다.
- 특정 지역에서만 제공해야 하는 콘텐츠가 있을 때 유용합니다.
- 예를 들어, 미국 사용자는 미국 리소스로, 유럽 사용자는 유럽 리소스로 라우팅할 수 있습니다.
- 기본 위치를 설정하여, 지정된 위치 외의 사용자가 접근할 때의 라우팅 경로를 정의할 수 있습니다.

### 3.6 지리 근접성 라우팅 (Geoproximity Routing)

- 사용자의 지리적 위치와 리소스의 위치에 따라 트래픽을 라우팅합니다.
- 리소스의 가중치를 조정하여 트래픽 분포를 제어할 수 있습니다.
- 사용 예시: 특정 지역에 있는 사용자를 우선적으로 가까운 리소스로 라우팅합니다.
- 정의된 바이어스(편향) 값에 따라 리소스로 더 많은 트래픽을 보내거나 줄일 수 있습니다.
	- 확장 (1에서 99까지): 리소스로 더 많은 트래픽을 보냅니다.
	- 축소 (-1에서 -99까지): 리소스로 가는 트래픽을 줄입니다.
- AWS 리소스(AWS 리전 지정)와 비-AWS 리소스(위도와 경도 지정)를 모두 사용할 수 있습니다.
- 이 기능을 사용하려면 Route 53 Traffic Flow를 사용해야 합니다.

#### 3.6.1 지리 근접성 라우팅과 지리 위치 기반 라우팅의 차이점

- **기준점**
	- 지리 근접성: 사용자와 리소스 간의 물리적 거리
	- 지리 위치: 사용자의 지리적 위치 (국가, 대륙, 주 등)
- **유연성**
	- 지리 근접성: 바이어스를 통해 리소스의 영향 범위를 동적으로 조절 가능
	- 지리 위치: 미리 정의된 지리적 경계에 따라 고정적으로 라우팅
- **사용 사례**
	- 지리 근접성: 가장 가까운 서버로 라우팅하여 지연 시간 최소화
	- 지리 위치: 특정 지역에 맞춤화된 콘텐츠 제공 또는 규제 준수
- **설정 방식**
	- 지리 근접성: AWS 리전 또는 위도/경도로 리소스 위치 지정
	- 지리 위치: 국가, 대륙, 미국 주 등의 지리적 위치로 설정
- **트래픽 분산**
	- 지리 근접성: 바이어스를 통해 트래픽 분산을 세밀하게 조정 가능
	- 지리 위치: 미리 정의된 지리적 영역에 따라 트래픽 분산

### 3.7 멀티 값 응답 라우팅 (Multi-Value Answer Routing)

- 여러 리소스로 트래픽을 분산시켜 가용성을 높입니다.
- DNS 응답에 여러 IP 주소를 포함시켜 트래픽을 분산할 수 있습니다.
- 사용 예시: 여러 웹 서버의 IP 주소를 반환하여, 사용자 요청을 여러 서버로 분산합니다.
- 여러 리소스에 트래픽을 보낼 때 사용합니다.
- Route 53은 한 번의 DNS 쿼리에 대해 여러 개의 IP 주소나 리소스를 반환합니다.
- 헬스 체크와 연동할 수 있으며, 헬스 체크를 통과한 건강한 리소스만 반환합니다.
- 각 멀티 값 쿼리에 대해 최대 8개의 건강한 레코드를 반환합니다.
- 멀티 값 라우팅은 ELB(Elastic Load Balancer)를 대체하기 위한 용도로 사용되지 않습니다.

**Multi-Value Answer와 Simple에서 값을 복수개로 하는 것의 차이점**

- **Multi-Value Answer Routing**
	- 헬스 체크와 연동하여, 헬스 체크를 통과한 건강한 리소스만 반환합니다.
	- 각 멀티 값 쿼리에 대해 최대 8개의 건강한 레코드를 반환합니다.
	- 여러 리소스로의 트래픽 분산을 통해 가용성을 높이는 데 중점을 둡니다.
- **Simple Routing에서 복수 값 설정**
	- 복수 개의 값을 설정할 수 있지만, 헬스 체크와 연동되지 않습니다.
	- 클라이언트가 반환된 여러 값 중 무작위로 하나를 선택하여 연결합니다.
	- 헬스 체크를 사용하지 않으므로, 비정상적인 리소스도 반환될 수 있습니다.
	- 단순히 여러 리소스 중 하나를 선택하는 방식으로, 가용성을 보장하지 않습니다.

### 3.8 IP-based Routing

- 클라이언트의 IP 주소를 기반으로 트래픽을 라우팅합니다.
- 사용 예시: 특정 IP 주소에서 오는 트래픽을 특정 서버로 라우팅합니다.
- 사용 사례: 성능 최적화, 네트워크 비용 절감 등
- 예시: 특정 ISP에서 오는 최종 사용자를 특정 엔드포인트로 라우팅합니다.

## 4 Record

### 4.1  Alias 레코드

- Alias 레코드는 특정 AWS 리소스에 대한 도메인 이름을 매핑하는 데 사용됩니다.
- Route 53이 AWS 리소스의 IP 주소를 자동으로 업데이트하므로, 수동으로 IP 주소를 관리할 필요가 없습니다.
- Alias 레코드는 주로 다음과 같은 AWS 리소스에 사용됩니다:
	- Amazon S3 버킷
	- Amazon CloudFront 배포
	- Elastic Load Balancer(ELB)
	- Amazon API Gateway
	- 다른 Route 53 호스팅 영역
- Alias 레코드는 일반적으로 A 또는 AAAA 레코드와 유사하지만, AWS 리소스와 통합되어 더 많은 유연성과 간편한 관리를 제공합니다.
- Alias 레코드는 무료로 사용 가능합니다.\
- Alias 레코드는 도메인의 zone apex(루트 도메인)를 AWS 리소스에 연결하는 데 특히 유용합니다.
- 일반적인 DNS 표준을 위반하지 않고 zone apex에서 사용할 수 있습니다.
- Application Load Balancer(ALB)와 같은 AWS 리소스의 IP 주소가 변경되더라도 자동으로 업데이트되어 A 레코드보다 더 안정적입니다.
- AWS 인프라와 네이티브하게 통합되어 더 나은 성능을 제공합니다.

#### 4.2.1 A 레코드

- IPv4 주소를 도메인 이름에 매핑합니다.
- 정적 IP 주소가 필요하므로 ALB와 같은 동적 리소스에는 적합하지 않습니다.
  \

#### 4.2.2 AAAA 레코드

- IPv6 주소를 도메인 이름에 매핑합니다.
- 현재 많은 AWS 리소스가 IPv6를 지원하지 않아 사용이 제한적입니다.

#### 4.2.3 CNAME 레코드

- 한 도메인 이름을 다른 도메인 이름으로 매핑합니다.
- DNS 표준에 따라 zone apex에서 사용할 수 없습니다.
- 다른 DNS 레코드와 충돌할 수 있습니다.

**참고 자료**

- [Amazon Route 53 공식 문서](https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/Welcome.html)
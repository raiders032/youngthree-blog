---
title: "KMS(Key Management Service)"
description: "AWS KMS의 핵심 기능과 활용 방법을 상세히 설명합니다. 키 생성부터 관리, 회전, 다중 리전 설정까지 실무에서 필요한 모든 내용을 다룹니다."
tags: ["AWS_KMS", "AWS", "SECURITY", "ENCRYPTION", "CLOUD", "DEVOPS", "IAM", "CLOUDTRAIL"]
keywords: ["AWS KMS", "Key Management Service", "암호화", "키 관리", "보안", "AWS 보안", "KMS", "암호화 키", "키 회전", "CMK", "HSM", "대칭키", "비대칭키", "AWS 암호화", "클라우드 보안", "키 정책", "다중 리전 키", "Customer Managed Key"]
draft: false
hide_title: true
---

## 1 KMS

- AWS Key Management Service (AWS KMS)는 데이터 보호를 위해 암호화 키를 생성하고 제어할 수 있도록 지원하는 관리형 서비스입니다.
- AWS KMS는 FIPS 140-2 암호화 모듈 검증 프로그램 하에 하드웨어 보안 모듈(HSM)을 사용하여 AWS KMS 키를 보호하고 검증합니다.
- AWS는 암호화 키를 관리해주며, IAM(Identity and Access Management)과 완벽하게 통합되어 인가를 처리합니다.
- 이로 인해 데이터에 대한 접근을 쉽게 제어할 수 있으며, CloudTrail을 사용하여 KMS 키 사용을 감사할 수 있습니다.
- KMS는 대부분의 AWS 서비스(EBS, S3, RDS, SSM 등)와 원활하게 통합되어 있으며, API 호출(SDK, CLI)을 통해 암호화 기능을 사용할 수 있습니다.
- 절대 비밀을 평문으로 저장하지 마세요, 특히 코드 안에! 암호화된 비밀은 코드나 환경 변수에 안전하게 저장할 수 있습니다.

## 2 키 생성 및 관리

- AWS KMS API를 사용하여 KMS 키와 특수 기능(예: 사용자 지정 키 스토어)을 생성하고 관리할 수 있습니다.
- 다음은 KMS 키 관리의 주요 기능입니다:
	- **대칭 및 비대칭 KMS 키 생성, 편집, 조회**: HMAC 키 포함
	- **키 정책, IAM 정책, 그리고 권한을 통한 접근 제어**: 속성 기반 접근 제어(ABAC) 지원
	- **별칭 생성, 삭제, 목록 조회 및 업데이트**: 별칭을 통해 KMS 키 접근 제어 가능
	- **KMS 키 태그 지정**: 식별, 자동화 및 비용 추적을 위해 태그 사용
	- **KMS 키 활성화 및 비활성화**
	- **자동 키 회전 활성화 및 비활성화**
	- **KMS 키 삭제**: 키 수명 주기 완료

## 3 암호화 작업

- AWS KMS 키를 사용하여 아래와 같은 다양한 암호화 작업을 수행할 수 있습니다
- 대칭 또는 비대칭 KMS 키를 사용한 데이터 암호화, 복호화 및 재암호화
- 비대칭 KMS 키를 사용한 메시지 서명 및 검증
- 내보낼 수 있는 대칭 데이터 키 및 비대칭 데이터 키 쌍 생성
- HMAC 코드 생성 및 검증
- 암호화 용도로 적합한 랜덤 숫자 생성

## 4 고급 기능

- AWS KMS는 다음과 같은 고급 기능을 제공합니다:
- 멀티-리전 키 생성: 여러 AWS 리전에서 동일한 KMS 키 복사본처럼 작동
- 암호화 재료 가져오기: KMS 키로 암호화 재료 가져오기
- AWS CloudHSM 키 스토어: AWS CloudHSM 클러스터로 백업되는 KMS 키 생성
- 외부 키 스토어: AWS 외부의 암호화 키로 백업되는 KMS 키 생성
- VPC 내 프라이빗 엔드포인트를 통해 직접 연결
- 하이브리드 양자 내성 TLS 사용: AWS KMS로 전송하는 데이터에 대한 미래 지향적 암호화 제공

## 5 CloudTrail을 이용한 키 사용 감사

- AWS CloudTrail을 사용하여 키 사용을 감사할 수 있습니다.
- CloudTrail은 계정의 AWS API 호출 및 관련 이벤트에 대한 기록을 포함한 로그 파일을 생성합니다.
- 이러한 로그 파일에는 AWS Management Console, AWS SDK 및 명령줄 도구로 수행된 모든 AWS KMS API 요청이 포함됩니다.
- 또한 AWS 서비스가 사용자 대신 AWS KMS에 요청하는 내용도 포함됩니다.
- 이 로그 파일을 통해 KMS 키 사용 시점, 요청된 작업, 요청자의 신원 및 소스 IP 주소 등의 중요한 정보를 찾을 수 있습니다.

## 6 키 회전

### 6.1 키 회전 방법

- AWS KMS에서는 고객 관리형 키에 대해 자동 및 수동 키 회전을 지원합니다.
- 키 회전의 주요 방법은 다음과 같습니다:
    - **자동 키 회전**: 기본적으로 AWS KMS는 매년 한 번 KMS 키의 암호화 자료를 자동으로 갱신합니다.
    - **수동 키 회전**: 새로운 KMS 키를 생성하고 기존 KMS 키 대신 사용하는 방법입니다.

### 6.2 자동 키 회전 설정

- 자동 키 회전을 설정하면 AWS KMS가 정의된 회전 주기에 따라 키 자료를 자동으로 갱신합니다.
- 기본 회전 주기는 365일이며, 필요에 따라 사용자 정의 회전 기간을 설정할 수 있습니다.
- 자동 키 회전이 활성화된 상태에서 온디맨드 회전을 수행해도 기존 자동 회전 일정은 변경되지 않습니다.

### 6.3 온디맨드 키 회전

- 온디맨드 키 회전을 통해 필요할 때마다 즉시 키 자료를 갱신할 수 있습니다.
- 온디맨드 회전은 자동 회전이 활성화된 경우에도 별도로 수행할 수 있습니다.
- AWS KMS는 온디맨드 회전이 완료된 후에도 이전 회전 일정을 유지합니다.

### 6.4 수동 키 회전

- 수동 키 회전은 새로운 KMS 키를 생성하여 기존 KMS 키 대신 사용하는 방법입니다.
- 이 방법은 자동 회전이 지원되지 않는 키 유형에 유용합니다.
- 수동 회전 후 애플리케이션 코드를 수정하지 않으려면 별칭을 사용하여 새로운 KMS 키로 업데이트할 수 있습니다.

### 6.5 키 회전 모니터링

- KMS 자체는 키 회전 기간을 모니터링하는 내장 기능을 제공하지 않습니다.
  - 키 사용 기간의 자동 추적이나 알림 기능이 없습니다.
- 대신 AWS Config를 사용해 키 회전을 모니터링 할 수 있습니다.
  - AWS Config는 AWS 리소스의 구성 변경을 평가, 감사 및 평가할 수 있는 서비스입니다. 
  - KMS 키 회전 상태를 모니터링하기 위한 사용자 정의 규칙을 생성할 수 있습니다. 
  - Config 규칙을 통해 다음을 수행할 수 있습니다:
    - 키의 마지막 회전 날짜 추적 
    - 회전되지 않은 키 식별 
    - SNS 통해 알림 설정 
    - 규정 준수 보고서 생성
  - 예를 들어 90일 동안 회전되지 않은 키가 있을 경우 알림을 받기를 원할 경우 사용할 수 있습니다.

## 7 KMS 키 유형

- 기존 KMS Customer Master Key (CMK)를 KMS Keys로 용어를 변경하였습니다.

### 7.1 대칭 키 (AES-256 키)

- 단일 암호화 키를 사용하여 암호화 및 복호화를 수행합니다.
- AWS KMS와 통합된 서비스들은 대칭 KMS 키를 사용합니다.
- 사용자는 암호화되지 않은 KMS 키에 직접 접근할 수 없으며, KMS API를 통해서만 사용할 수 있습니다.
- **회전 정책:**
	- 자동 회전 지원: 활성화 시 1년(약 365일)마다 자동으로 회전됩니다.
	- 수동 회전도 가능합니다.
	- 회전 시 키 ID는 변경되지 않습니다. 
- **회전 과정:** 
	- 새로운 백엔드 키 자료가 생성됩니다.
	- 이전 키 자료는 보존되어 기존 데이터 복호화에 사용됩니다. 
	- 새로운 암호화 작업은 새 키 자료를 사용합니다.

### 7.2 비대칭 키 (RSA 및 ECC 키 쌍)

- 공개 키(암호화)와 비공개 키(복호화) 쌍을 사용합니다.
- 암호화/복호화 또는 서명/검증 작업에 사용됩니다.
- 공개 키는 다운로드할 수 있지만, 비공개 키는 암호화되지 않은 상태로 접근할 수 없습니다.
- 비대칭 키는 KMS API를 호출할 수 없는 사용자들이 AWS 외부에서 암호화를 수행할 때 유용합니다.
- **회전 정책:**
	- AWS KMS는 비대칭키에 대한 자동 회전을 지원하지 않습니다.
	- 수동 회전만 가능합니다. 
- **수동 회전 과정:** 
	- 1. 새로운 비대칭 CMK를 생성합니다. 
	- 2. 애플리케이션과 IAM 정책을 업데이트하여 새 키를 사용하도록 합니다. 
	- 3. 이전 키는 기존 데이터 복호화를 위해 보존합니다.

## 8 KMS 키 관리 유형

### 8.1 AWS Owned Keys (무료)

- AWS 소유 키는 기본적으로 자동 암호화를 제공하는 키입니다.
	- 고객이 직접 보거나 관리할 수 없습니다.
- **SSE-S3**: Amazon S3에서 제공하는 서버 측 암호화
- **SSE-SQS**: Amazon SQS에서 제공하는 서버 측 암호화
- **SSE-DDB**: Amazon DynamoDB에서 제공하는 서버 측 암호화
- **키 회전:** 
	- AWS에 의해 자동으로 관리되며, 고객이 회전 주기나 정책을 확인하거나 변경할 수 없습니다.
	- AWS는 보안 모범 사례에 따라 내부적으로 키를 관리하고 회전합니다.

### 8.2 AWS Managed Key (무료)

- AWS 관리 키는 특정 AWS 서비스에 대해 자동으로 생성되고 관리되는 키입니다.
- 예시: `aws/rds` 또는 `aws/ebs` 키
- 사용자가 직접 관리할 필요 없이 AWS가 키를 관리해줍니다.
- 자동으로 교체되며, 고객이 직접 삭제할 수 없습니다.
- **키 회전:**
	- AWS에 의해 자동으로 매년(365일마다) 회전됩니다.
	- 회전은 투명하게 이루어지며, 기존 데이터의 가용성에 영향을 미치지 않습니다.
	- 고객은 회전 주기를 변경하거나 비활성화할 수 없습니다.

### 8.3 Customer managed keys created in KMS (월 $1)

- 고객이 직접 AWS KMS를 통해 생성하고 관리하는 키입니다.
- **사용 요금**: 키 하나당 월 $1
- 추가로 KMS API 호출당 비용이 발생합니다 ($0.03 / 10,000 calls)
- **키 회전:**
	- 기본적으로 자동 회전이 비활성화되어 있습니다. 
	- 고객이 자동 회전을 활성화할 수 있으며, 활성화 시 매년(약 365일마다) 자동으로 회전됩니다.
	- 수동 회전도 가능하며, 고객이 직접 새 키를 생성하고 별칭을 업데이트하는 방식으로 수행합니다. 
	- 자동 회전 시 키 ID는 변경되지 않지만, 수동 회전 시 새로운 키 ID가 생성됩니다.


### 8.4 Customer managed keys imported (월 $1)

- 고객이 외부에서 생성한 암호화 키를 AWS KMS로 가져와 사용하는 경우입니다.
- **사용 요금**: 키 하나당 월 $1
- 추가로 KMS API 호출당 비용이 발생합니다 ($0.03 / 10,000 calls)
- **키 회전:**
	- 가져온 키 자료에 대해서는 AWS KMS의 자동 키 회전 기능을 사용할 수 없습니다.
	- 수동으로만 회전이 가능하며, 고객이 직접 새로운 키 자료를 생성하고 가져와야 합니다.
	- 수동 회전 시, 새로운 키 자료를 동일한 CMK에 가져오거나, 새로운 CMK를 생성하고 키 자료를 가져올 수 있습니다. 
	- 키 회전 시 기존 데이터의 복호화 가능성을 유지하기 위해 이전 키 자료를 보관해야 합니다.

## 9 KMS 키 정책

- KMS 키 정책은 KMS 키에 대한 접근을 제어하는 데 사용됩니다.
- 이는 S3 버킷 정책과 유사하지만, KMS 키 정책 없이는 접근을 제어할 수 없습니다.

### 9.1 기본 KMS 키 정책

- 별도의 KMS 키 정책을 제공하지 않으면 기본 키 정책이 생성됩니다.
- 기본 키 정책은 루트 사용자에게 키에 대한 전체 접근 권한을 부여합니다. 즉, 전체 AWS 계정에 대한 접근을 허용합니다.

### 9.2 사용자 정의 KMS 키 정책

- 사용자 정의 키 정책을 통해 KMS 키에 접근할 수 있는 사용자 및 역할을 정의할 수 있습니다.
- 또한 키를 관리할 수 있는 관리자 권한을 설정할 수 있습니다.
- 이는 계정 간에 KMS 키 접근을 허용할 때 유용합니다.

## 10 KMS 다중 리전 키

- KMS 다중 리전 키는 다른 AWS 리전에서 동일하게 사용할 수 있는 동일한 KMS 키입니다.
- 다중 리전 키는 동일한 키 ID, 키 자료, 자동 회전을 가지며, 한 리전에서 암호화하고 다른 리전에서 복호화할 수 있습니다.
- 데이터를 다시 암호화하거나 리전을 넘나드는 API 호출을 할 필요가 없습니다.

### 10.1 다중 리전 키 관리

- KMS 다중 리전 키는 글로벌 키가 아니며, 각 리전에서 독립적으로 관리됩니다.
- 각 다중 리전 키는 기본 키와 복제본으로 구성됩니다.

### 10.2 사용 사례

- 글로벌 클라이언트 측 암호화
- 글로벌 DynamoDB 암호화
- 글로벌 Aurora 암호화
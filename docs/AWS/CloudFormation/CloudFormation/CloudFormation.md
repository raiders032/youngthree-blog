## 1 AWS CloudFormation

- AWS CloudFormation은 인프라를 코드로 관리할 수 있게 해주는 서비스입니다.
- 템플릿을 사용하여 AWS 리소스를 자동으로 프로비저닝하고 관리할 수 있습니다.
- 이를 통해 인프라의 배포와 관리를 일관되게 수행할 수 있습니다.



## 2 주요 기능

### 2.1 인프라를 코드로 관리

- CloudFormation은 템플릿을 사용하여 AWS 리소스를 코드로 정의할 수 있습니다.
- 수동으로 리소스를 생성하지 않기 때문에 제어가 용이합니다.
- 코드 버전 관리를 통해 Git과 같은 버전 관리 시스템을 사용할 수 있습니다.
- 인프라 변경 사항은 코드 리뷰를 통해 검토됩니다.



### 2.2 템플릿 기반 프로비저닝

- YAML 또는 JSON 형식의 템플릿을 사용하여 리소스를 정의할 수 있습니다.
- 템플릿에는 리소스 구성, 의존성, 런타임 매개변수 등을 포함할 수 있습니다.
- [[Template]] 참고



### 2.3 스택 관리

- CloudFormation은 스택(Stack)이라는 단위를 사용하여 리소스를 그룹화합니다.
- 스택을 통해 여러 리소스를 하나의 단위로 배포하고 관리할 수 있습니다.
- 스택 업데이트를 통해 기존 리소스를 변경하거나 추가할 수 있습니다.



### 2.4 자동 롤백

- 스택 생성 또는 업데이트 중 오류가 발생하면 자동으로 롤백하여 이전 상태로 복원할 수 있습니다.
- 이를 통해 인프라 변경 시 발생할 수 있는 문제를 최소화할 수 있습니다.



### 2.5 변경 세트(Change Sets)

- 스택 업데이트 전에 변경 세트를 생성하여 변경 사항을 미리 검토할 수 있습니다.
- 이를 통해 예상치 못한 변경으로 인한 문제를 방지할 수 있습니다.



### 2.6 크로스 스택 참조

- 하나의 스택에서 생성된 리소스를 다른 스택에서 참조할 수 있습니다.
- 이를 통해 리소스 간의 의존성을 관리하고 재사용할 수 있습니다.



## 3 CloudFormation의 장점

### 3.1 일관성

- 모든 리소스를 코드로 관리하여 일관성을 유지할 수 있습니다.
- 이를 통해 수작업으로 인한 오류를 줄일 수 있습니다.
- 인프라 변경 사항을 코드로 검토할 수 있어 더욱 안정적인 변경 관리가 가능합니다.



### 3.2 효율성

- 템플릿을 재사용하여 인프라 배포 시간을 단축할 수 있습니다.
- 이를 통해 신속하게 환경을 구축하고 운영할 수 있습니다.
- 모든 리소스가 자동으로 프로비저닝되므로, 수작업 생성에 따른 오류를 방지할 수 있습니다.



### 3.3 가시성

- 템플릿을 통해 인프라 구성 상태를 쉽게 파악할 수 있습니다.
- 이를 통해 인프라 변경 사항을 추적하고 관리할 수 있습니다.
- 각 스택의 리소스는 고유한 식별자로 태그가 지정되어 있어, 스택 비용을 쉽게 확인할 수 있습니다.



### 3.4 확장성

- 다양한 AWS 리소스를 지원하여 복잡한 인프라 요구 사항을 충족할 수 있습니다.
- 이를 통해 다양한 워크로드를 효율적으로 처리할 수 있습니다.
- CloudFormation 템플릿을 사용하여 리소스 비용을 추정할 수 있습니다.
- 지원되지 않는 리소스는 "커스텀 리소스"를 사용하여 통합할 수 있습니다.



### 3.5 비용 관리

- 템플릿을 통해 리소스 구성을 표준화하여 비용을 절감할 수 있습니다.
- 불필요한 리소스 생성을 방지하고 효율적인 리소스 사용을 유도할 수 있습니다.
- 개발 환경에서는 템플릿을 5PM에 자동 삭제하고 8AM에 다시 생성하도록 설정하여 비용을 절감할 수 있습니다.



### 3.6 생산성

- 인프라를 즉시 파괴하고 재생성할 수 있는 기능을 통해 유연한 인프라 관리를 할 수 있습니다.
- 템플릿에 대한 다이어그램을 자동으로 생성하여 시각적으로 이해하기 쉽게 합니다.
- 선언형 프로그래밍을 사용하여 순서와 오케스트레이션을 고민할 필요 없이 인프라를 정의할 수 있습니다.
- 기존의 템플릿과 문서를 활용하여 새로운 템플릿을 작성하는 시간을 절약할 수 있습니다.
- 웹에서 제공되는 다양한 템플릿을 활용하여 필요한 인프라를 빠르게 구축할 수 있습니다.



## 4 CloudFormation 사용 사례

### 4.1 인프라 자동화

- DevOps 파이프라인에서 CloudFormation을 사용하여 인프라를 자동으로 배포하고 관리할 수 있습니다.
- 이를 통해 반복 가능하고 일관된 인프라 환경을 구축할 수 있습니다.



### 4.2 복잡한 애플리케이션 배포

- CloudFormation을 사용하여 복잡한 애플리케이션을 여러 단계에 걸쳐 배포할 수 있습니다.
- 예: 데이터베이스, 네트워크 설정, 애플리케이션 서버를 포함한 멀티 티어 아키텍처



### 4.3 재해 복구

- CloudFormation 템플릿을 사용하여 재해 복구 계획을 자동화할 수 있습니다.
- 이를 통해 신속하게 인프라를 복원하고 가동 중지 시간을 최소화할 수 있습니다.



### 4.4 비용 관리

- 템플릿을 통해 리소스 구성을 표준화하여 비용을 절감할 수 있습니다.
- 불필요한 리소스 생성을 방지하고 효율적인 리소스 사용을 유도할 수 있습니다.



## 5 예시 템플릿

```yaml
AWSTemplateFormatVersion: '2010-09-09'
Description: AWS CloudFormation Sample Template

Parameters:
  InstanceType:
    Description: EC2 인스턴스 타입
    Type: String
    Default: t2.micro
    AllowedValues:
      - t2.micro
      - t2.small
      - t2.medium

Resources:
  MyEC2Instance:
    Type: AWS::EC2::Instance
    Properties:
      InstanceType: !Ref InstanceType
      ImageId: ami-0abcdef1234567890

Outputs:
  InstanceId:
    Description: 생성된 EC2 인스턴스 ID
    Value: !Ref MyEC2Instance

```



## 6 CloudFormation 서비스 역할

- CloudFormation 서비스 역할은 CloudFormation이 사용자 대신 스택 리소스를 생성, 업데이트, 삭제할 수 있도록 허용하는 IAM 역할입니다.
- 이를 통해 사용자가 스택 리소스를 생성, 업데이트, 삭제할 수 있지만, 스택 내 리소스 작업에 필요한 모든 권한을 가지지 않아도 됩니다.



### 6.1 IAM 역할

- **IAM 역할**: CloudFormation이 사용자 대신 작업을 수행할 수 있도록 필요한 권한을 가진 IAM 역할을 설정합니다.
- 이 역할을 통해 CloudFormation은 스택 리소스를 안전하게 관리할 수 있습니다.



### 6.2 사용자 권한

- **사용자 권한**: 사용자는 `iam:PassRole` 권한을 가지고 있어야 합니다.
- 이를 통해 CloudFormation이 사용자를 대신하여 IAM 역할을 사용할 수 있습니다.



### 6.3 사용 사례

- **최소 권한 원칙**: 최소 권한 원칙을 달성하고자 할 때 유용합니다.
- **제한된 권한**: 사용자가 스택 리소스를 생성할 수 있는 모든 권한을 갖지 않기를 원할 때 유용합니다.
- CloudFormation 서비스 역할을 사용하면 사용자는 필요한 최소 권한만 가지고 스택을 관리할 수 있습니다.
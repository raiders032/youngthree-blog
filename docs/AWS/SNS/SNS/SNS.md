## 1 SNS(Simple Notification Service)

- [레퍼런스](https://docs.aws.amazon.com/sns/latest/dg/welcome.html)
- Amazon SNS는 게시자(publishers)로부터 구독자(subscribers)에게 메시지를 전달하는 관리형 서비스입니다.
- 게시자들은 토픽이라는 논리적 액세스 포인트 및 통신 채널에 메시지를 보내며, 이를 통해 구독자들과 비동기적으로 통신할 수 있습니다.
- Amazon SNS는 높은 확장성을 제공하며, 다양한 애플리케이션에서 실시간 알림, 메시지 브로커 및 기타 비동기 메시징 요구 사항을 해결하는 데 적합합니다.



## 2 주요 기능

### 2.1 토픽 기반 메시징

- 게시자는 토픽(topic)에 메시지를 게시합니다.
- 구독자(subscriber)는 특정 토픽을 구독하여 해당 토픽에 게시된 메시지를 수신합니다.
- 이를 통해 게시자와 구독자 간의 느슨한 결합(loose coupling)을 구현할 수 있습니다.
- 토픽을 구독한 모든 구독자는 모든 메시지를 받습니다.
- 토픽당 최대 12,500,000개의 구독을 지원합니다.
- 100,000개의 토픽 제한이 있습니다.



**Standard Topic**

- 고가용성 및 높은 처리량
    - Standard 토픽은 높은 처리량과 무제한의 확장성을 제공합니다.
    - 메시지가 여러 구독자에게 동시에, 빠르게 전송됩니다.
- **최소한의 지연 시간**
    - 메시지 전송이 지연 없이 거의 즉시 이루어집니다.
- 중복 메시지 허용
    - 메시지가 중복될 수 있으며, 순서 보장이 필요 없는 상황에 적합합니다.
- 사용 사례
    - 빠른 알림 전송
    - 대규모 이벤트 브로드캐스트
    - 분산 시스템 간의 통신



**FIFO (First-In-First-Out) Topic**

- 순서 보장 및 중복 제거
    - FIFO 토픽은 메시지의 순서를 보장하며, 중복 메시지 전송을 방지합니다.
- 지연 시간
    - 순서와 중복 제거를 보장하기 때문에 Standard 토픽에 비해 약간의 지연이 발생할 수 있습니다.
- 한정된 처리량
    - Standard 토픽에 비해 처리량이 제한적입니다.
- 사용 사례
    - 거래 처리 시스템
    - 순서가 중요한 이벤트 스트림
    - 데이터 스트리밍 서비스



### 2.2 다양한 전송 프로토콜 지원

- Amazon SNS는 여러 전송 프로토콜을 지원하여 다양한 방식으로 메시지를 전달할 수 있습니다.
    - **HTTP/HTTPS**: 웹 서버에 메시지를 전달합니다.
    - **Email/Email-JSON**: 이메일을 통해 메시지를 전달합니다.
    - **SMS**: 문자 메시지로 메시지를 전달합니다.
    - **AWS Lambda**: Lambda 함수를 호출하여 메시지를 처리합니다.
    - **Application**: 모바일 장치로 푸시 알림을 전송합니다.
    - **SQS**: SQS 큐로 메시지를 전달하여 추가 처리를 수행합니다.



### 2.3 메시지 필터링

- Amazon SNS는 메시지 필터링 기능을 제공하여 구독자들이 특정 조건에 맞는 메시지만 수신할 수 있도록 합니다.
- 메시지 속성(attribute)을 사용하여 구독자가 수신할 메시지를 필터링할 수 있습니다.
- 이를 통해 구독자는 필요하지 않은 메시지를 걸러내고, 원하는 메시지만 처리할 수 있습니다.



### 2.4 확장성 및 성능

- Amazon SNS는 자동으로 확장하여 높은 트래픽을 처리할 수 있습니다.
- 수백만 개의 메시지를 초당 전송할 수 있는 성능을 제공합니다.
- 애플리케이션의 규모에 관계없이 실시간 알림을 안정적으로 전달할 수 있습니다.



## 3 사용 사례

### 3.1 실시간 알림

- 시스템 이벤트, 오류, 상태 변경 등을 실시간으로 알림으로써 빠른 대응이 가능합니다.
- 예: 서버 상태 변경, 애플리케이션 이벤트 알림



### 3.2 모바일 푸시 알림

- 모바일 애플리케이션에 푸시 알림을 전송하여 사용자에게 실시간 업데이트를 제공합니다.
- 예: 뉴스 업데이트, 프로모션 알림



### 3.3 분산 시스템 통합

- 여러 서비스 간에 이벤트를 전달하여 시스템 간 통합을 쉽게 구현할 수 있습니다.
- 예: 마이크로서비스 아키텍처에서 서비스 간 이벤트 전달



#### 3.4 장애 알림 및 모니터링

- 시스템 장애나 성능 문제를 모니터링하고, 관리자에게 즉시 알림을 보낼 수 있습니다.
- 예: CloudWatch 경고 알림, 시스템 오류 알림



## 4 SQS와의 차이점

|**특징**|**Amazon SNS (Simple Notification Service)**|**Amazon SQS (Simple Queue Service)**|
|---|---|---|
|**서비스 유형**|Pub/Sub 시스템|큐잉 서비스|
|**메시지 전달 방식**|push 방식|poll 방식|
|**메시지 전달**|메시지를 토픽에 게시하면 여러 구독자에게 메시지가 전달됩니다.|일반적으로 큐의 메시지는 하나의 소비자(consumer)에 의해 처리됩니다.|
|**주요 사용 사례**|실시간 알림, 알림 브로커, 비동기 이벤트 처리|작업 대기열, 비동기 작업 처리, 백엔드 시스템의 디커플링|
|**메시지 내구성**|기본적으로 메시지는 전달 후 삭제|메시지는 큐에서 읽혀지고 명시적으로 삭제될 때까지 큐에 남아 있음|
|**처리 방식**|구독자들은 메시지를 수신하기 위해 별도의 설정 필요 없음|소비자들은 주기적으로 큐를 폴링하여 메시지를 수신해야 함|
|**스케일링**|토픽을 통해 다수의 구독자에게 확장 가능|메시지를 큐에 저장하여 여러 소비자가 병렬로 처리 가능|



## 5 Amazon SNS – Security

- Amazon SNS는 강력한 보안 기능을 제공하여 데이터와 접근을 보호합니다. 
- 다음은 Amazon SNS의 주요 보안 기능입니다.



### 5.1 Encryption

- **In-flight 암호화**: 데이터가 네트워크를 통해 전송되는 동안 HTTPS API를 사용하여 암호화됩니다.
    - 이를 통해 전송 중에 데이터가 가로채여도 안전하게 보호됩니다.
- **At-rest 암호화**: 저장된 데이터는 AWS KMS(Key Management Service) 키를 사용하여 암호화됩니다.
    - 저장된 데이터에 대한 물리적 접근이나 보안 침해가 발생하더라도 데이터를 안전하게 유지할 수 있습니다.
- **Client-side 암호화**: 클라이언트가 자체적으로 데이터를 암호화 및 복호화할 수 있는 옵션을 제공합니다.
    - 이 경우, 클라이언트는 데이터가 SNS에 전송되기 전에 암호화를 수행하고, 수신 시 복호화를 수행합니다.



### 5.2 Access Controls

- **IAM Policies**: AWS Identity and Access Management(IAM) 정책을 사용하여 SNS API에 대한 접근을 제어합니다.
    - 이를 통해 특정 사용자나 서비스에 대해 SNS 토픽에 대한 접근 권한을 세밀하게 설정할 수 있습니다.
- **SNS Access Policies**: S3 버킷 정책과 유사한 방식으로 SNS 액세스 정책을 설정할 수 있습니다.
    - 이는 계정 간 접근을 허용하거나 제한하는 데 유용합니다.
    - 예를 들어, 다른 AWS 계정이 특정 SNS 토픽에 게시(publish)할 수 있도록 허용할 수 있습니다.



### 5.3 Cross-Account Access

- **Cross-Account Access**: SNS 액세스 정책을 사용하여 다른 AWS 계정이 SNS 토픽에 접근할 수 있도록 설정할 수 있습니다.
- 이는 여러 계정에서 공통의 SNS 토픽을 사용해야 하는 시나리오에서 유용합니다.



### 5.4 서비스 간 통합

- **Service Integration**: S3와 같은 다른 AWS 서비스가 SNS 토픽에 메시지를 게시할 수 있도록 허용할 수 있습니다.
- 예를 들어, S3 버킷에 파일이 업로드되면 SNS 토픽에 알림을 게시하여 다른 시스템이나 서비스가 이를 처리할 수 있도록 할 수 있습니다.



## 6 SNS + SQS: Fan Out 패턴

- Amazon SNS와 SQS의 통합을 통한 Fan Out 패턴은 메시지 전달과 데이터 처리의 효율성을 극대화할 수 있는 강력한 방법입니다.



### 6.1 Fan Out 패턴 개요

- **SNS Topic**: 메시지를 게시할 수 있는 논리적 액세스 포인트입니다.
- **SQS Queue**: 메시지를 저장하고, 필요한 경우 데이터를 지연 처리하거나 재시도할 수 있는 큐입니다.
- **Push once in SNS, receive in all SQS queues that are subscribers**: 하나의 SNS 토픽에 메시지를 게시하면, 이를 구독한 모든 SQS 큐에 메시지가 전달됩니다.



### 6.2 Fan Out 패턴의 장점

- **Fully decoupled, no data loss**: SNS와 SQS의 통합은 시스템 간의 느슨한 결합을 구현하며, 데이터 손실 없이 메시지를 안전하게 전달합니다.
- **Data persistence, delayed processing, and retries**: SQS는 데이터를 영구적으로 저장할 수 있으며, 메시지 처리를 지연하거나 실패 시 재시도를 지원합니다.
- **Scalability**: 시간이 지남에 따라 더 많은 SQS 구독자를 추가할 수 있어 확장성이 뛰어납니다.
- **Cross-Region Delivery**: 다른 리전의 SQS 큐와도 함께 작동하여, 글로벌 규모의 메시지 전달이 가능합니다.



### 6.3 설정 및 주의 사항

- **SQS Queue Access Policy**: SQS 큐 접근 정책을 설정하여 SNS가 큐에 메시지를 쓸 수 있도록 해야 합니다.
- 이를 통해 SNS에서 게시된 메시지가 SQS 큐에 성공적으로 전달될 수 있습니다.



### 6.4 Cross-Region Delivery

- **Cross-Region Delivery**: SNS와 SQS의 통합은 다른 리전의 SQS 큐와도 함께 작동하여 글로벌 메시지 전달을 지원합니다.
- 예를 들어, 미국 리전의 SNS 토픽에서 유럽 리전의 SQS 큐로 메시지를 전달할 수 있습니다.



### 6.5 단순 SQS 사용과 차이점

**메시지 분배 방식**

- **단순 SQS 사용**: 각 서비스마다 별도의 SQS 큐를 설정하고, 이벤트 발생 시 각 큐에 개별적으로 메시지를 보내야 합니다.
    - 예를 들어, 새로운 주문이 발생하면 주문 처리, 결제 처리, 배송 처리를 위해 각 SQS 큐에 따로 메시지를 보내야 합니다.
- **SNS + SQS 사용 (Fan Out 패턴)**: SNS 토픽에 메시지를 한 번만 게시하면, 이를 구독한 모든 SQS 큐에 메시지가 자동으로 분배됩니다.
    - 예를 들어, 새로운 주문이 발생하면 SNS 토픽에 메시지를 한 번 게시하고, 이를 구독한 주문 처리, 결제 처리, 배송 처리 SQS 큐에 메시지가 자동으로 전달됩니다.



**관리 편의성**

- **단순 SQS 사용**: 여러 개의 SQS 큐를 각각 관리하고 메시지를 개별적으로 보내야 하기 때문에 관리가 복잡해집니다.
    - 각 큐에 대한 메시지 전송 로직을 별도로 구현해야 합니다.
- **SNS + SQS 사용 (Fan Out 패턴)**: SNS를 통해 메시지를 한 번만 게시하면 되므로 관리가 훨씬 간편해집니다.
    - 메시지 전송 로직이 단순해지고, 새로운 구독자를 추가할 때도 SNS 토픽에 구독만 추가하면 되므로 유연성이 높아집니다.



**확장성**

- **단순 SQS 사용**: 새로운 서비스가 메시지를 받아야 할 경우, 해당 서비스용 SQS 큐를 만들고 메시지 전송 로직을 추가로 구현해야 합니다.
- **SNS + SQS 사용 (Fan Out 패턴)**: 새로운 서비스가 메시지를 받아야 할 경우, SNS 토픽에 새로운 SQS 구독을 추가하기만 하면 됩니다.
    - 기존 메시지 전송 로직을 수정할 필요 없이 구독 추가만으로 확장 가능합니다.



**데이터 일관성 및 동기화**

- **단순 SQS 사용**: 여러 SQS 큐에 개별적으로 메시지를 전송할 때, 타이밍 문제로 인해 메시지 전달이 비일관적일 수 있습니다.
- **SNS + SQS 사용 (Fan Out 패턴)**: 모든 SQS 큐가 동시에 메시지를 받기 때문에 데이터 일관성이 보장됩니다.



## 7 Message Filtering

- Amazon SNS는 메시지 필터링 기능을 제공하여 구독자가 수신하는 메시지를 제어할 수 있습니다. 
- 이를 통해 각 구독자가 필요한 메시지만 받아 처리할 수 있도록 합니다.



### 7.1 메시지 필터링 개요

- **JSON Policy**: 메시지 필터링은 JSON 정책을 사용하여 설정됩니다. 구독자가 특정 조건에 맞는 메시지만 수신하도록 필터링 정책을 정의할 수 있습니다.
- **기본 동작**: 구독에 필터링 정책이 설정되지 않은 경우, 해당 구독자는 모든 메시지를 수신합니다.



### 7.2 메시지 필터링 설정

- 메시지 필터링을 설정하려면, 구독에 필터 정책을 추가해야 합니다. 
- 필터 정책은 메시지 속성을 기반으로 하며, 구독자가 수신할 메시지의 조건을 지정합니다.
## 1 Amazon EFS (Elastic File System)

- Amazon Elastic File System (Amazon EFS)는 서버리스이자 완전 탄력적인 파일 스토리지로, 스토리지 용량과 성능을 프로비저닝하거나 관리할 필요 없이 파일 데이터를 공유할 수 있습니다.
- Amazon EFS는 페타바이트까지 확장할 수 있으며, 파일을 추가하거나 제거할 때 자동으로 확장 및 축소되어 애플리케이션에 지장을 주지 않습니다.
- 간단한 웹 서비스 인터페이스를 통해 파일 시스템을 신속하게 생성하고 구성할 수 있습니다.
- Amazon EFS는 모든 파일 스토리지 인프라를 관리해주므로, 복잡한 파일 시스템 구성을 배포, 패치 및 유지 관리하는 어려움을 피할 수 있습니다.
- 여러 EC2 인스턴스에 마운트할 수 있으며, 여러 가용 영역(AZ)에 있는 EC2 인스턴스가 함께 사용할 수 있습니다.



## 2 주요 기능

### 2.1 자동 확장 및 축소

- EFS는 페타바이트 규모로 확장 가능하며, 파일을 추가하거나 제거할 때 자동으로 스토리지를 조정합니다. 
- 이는 애플리케이션의 성능에 영향을 주지 않고 스토리지 용량을 최적화할 수 있게 해줍니다.



### 2.2 표준 파일 시스템 인터페이스

- Amazon EFS는 NFSv4.1 및 NFSv4.0 프로토콜을 지원하므로, 현재 사용 중인 애플리케이션과 도구가 Amazon EFS와 원활하게 작동합니다. 
- 또한, Amazon EC2, Amazon ECS, Amazon EKS, AWS Lambda, AWS Fargate 등 다양한 AWS 컴퓨팅 인스턴스에서 접근할 수 있습니다.
- EFS는 리눅스 기반 AMI에서만 접근할 수 있습니다.



### 2.3 파일 시스템 타입

- Amazon EFS는 두 가지 파일 시스템 타입을 제공합니다
	- 리전(Regional)
	- 원 존(One Zone)
- 고가용성과 내구성이 중요한 경우 리전 파일 시스템을, 비용 효율성과 특정 워크로드에 맞춘 경우 원 존 파일 시스템을 선택하면 됩니다.



**리전(Regional) 파일 시스템**

- **개요**: 여러 가용 영역(AZ)에 걸쳐 데이터를 중복 저장하여 높은 가용성과 내구성을 제공합니다.
- **장점**:
    - **높은 가용성**: 하나의 AZ에서 장애가 발생해도 다른 AZ에서 데이터를 사용할 수 있어 서비스 중단을 최소화합니다.
    - **내구성**: 데이터가 여러 AZ에 중복 저장되므로 데이터 손실 위험이 낮습니다.
- **단점**:
    - **비용**: 데이터가 여러 AZ에 저장되므로 단일 AZ에 저장하는 것보다 비용이 더 높을 수 있습니다.



**원 존(One Zone) 파일 시스템**

- **개요**: 단일 가용 영역에 데이터를 저장하며, 특정 워크로드에 적합한 연속적인 데이터 가용성을 제공합니다.
- **장점**:
    - **비용 효율성**: 단일 AZ에 데이터를 저장하므로 리전 타입보다 비용이 낮습니다.
    - **적합한 워크로드**: 백업이나 복제본이 필요 없는 개발 및 테스트 환경에 적합합니다.
- **단점**:
    - **낮은 가용성**: 단일 AZ에 데이터가 저장되므로, 해당 AZ에 장애가 발생하면 데이터 접근이 불가능할 수 있습니다.
    - **내구성**: 데이터가 단일 AZ에만 저장되므로 데이터 손실 위험이 더 높습니다.



### 2.4 성능

![[Pasted image 20240621152712.png]]

- Performance Mode
	- **General Purpose (기본값)**: 지연 시간이 중요한 웹 서버 환경, 콘텐츠 관리 시스템(CMS) 등 지연 시간에 민감한 사용 사례에 적합합니다.
	- **Max I/O**: 높은 레이턴시, 높은 처리량 및 높은 병렬 처리가 필요한 대규모 데이터, 미디어 처리 워크로드에 적합합니다.
- Throughput Mode
	- **Bursting**: 1 TB의 스토리지당 50 MiB/s의 기본 처리량을 제공하며 최대 100 MiB/s까지 버스트할 수 있습니다.
	- **Provisioned**: 스토리지 크기에 관계없이 사용자가 설정한 처리량을 제공합니다. 예를 들어, 1 TB 스토리지에 대해 1 GiB/s의 처리량을 설정할 수 있습니다.
	- **Elastic**: 워크로드에 따라 자동으로 처리량을 조정하여 최대 3 GiB/s의 읽기 처리량과 1 GiB/s의 쓰기 처리량을 제공합니다. 예측할 수 없는 워크로드에 적합합니다.



### 2.5 스토리지 클래스

- Storage Tiers (Lifecycle 관리 기능)
    - Standard: 자주 접근하는 파일을 위해 설계됨
    - Infrequent access (EFS-IA): 파일을 검색하는 데 비용이 들지만, 저장 비용이 더 저렴함
    - Archive: 자주 접근하지 않는 데이터를 위해 설계됨 (연 몇 번만 접근), 저장 비용이 50% 저렴함
    - Lifecycle Management: 파일을 스토리지 계층 간에 이동하기 위한 정책 구현 가능



**Lifecycle Management 예시**

![[Pasted image 20240621152249.png]]



### 2.6 파일 시스템 접근 제어

- EFS는 강력한 데이터 일관성과 파일 잠금 기능을 제공하며, POSIX 권한을 통해 파일 시스템 접근을 제어할 수 있습니다.



### 2.7 보안 및 규정 준수

- **암호화**: 전송 중 암호화와 저장 중 암호화를 지원하여, 데이터와 메타데이터를 보호합니다.
- **IAM 및 네트워크 보안 정책**: NFS 클라이언트의 EFS 접근을 IAM 정책과 보안 그룹을 통해 제어할 수 있습니다.



## 3 EFS 마운트 타겟

- EFS 마운트 타겟은 EFS 파일 시스템을 EC2 인스턴스에 연결하는 데 사용되는 네트워크 인터페이스입니다.
- 각 마운트 타겟은 특정 가용 영역(AZ)에 생성됩니다.
- 마운트 타겟을 통해 해당 AZ 내의 EC2 인스턴스들이 EFS 파일 시스템에 접근할 수 있습니다.



### 3.1 마운트 타겟의 주요 특징

- **가용성 영역 특정**: 각 마운트 타겟은 특정 AZ에 연결됩니다.
- **IP 주소 할당**: 각 마운트 타겟에는 해당 AZ의 서브넷에서 IP 주소가 할당됩니다.
- **보안 그룹**: 마운트 타겟에 보안 그룹을 연결하여 네트워크 트래픽을 제어할 수 있습니다.
- **높은 가용성**: 여러 AZ에 마운트 타겟을 생성하여 고가용성을 확보할 수 있습니다.



### 3.2 마운트 타겟 설계 고려사항

- **성능 최적화**: EC2 인스턴스와 동일한 AZ에 마운트 타겟을 생성하면 네트워크 지연 시간을 최소화할 수 있습니다.
- **고가용성**: 여러 AZ에 마운트 타겟을 생성하면 한 AZ에 장애가 발생해도 다른 AZ의 인스턴스들이 파일 시스템에 접근할 수 있습니다.
- **비용 최적화**: 필요한 AZ에만 마운트 타겟을 생성하여 비용을 절감할 수 있습니다.

### 3.3 마운트 타겟 생성 전략

1. **단일 AZ 배포**: 모든 EC2 인스턴스가 동일한 AZ에 있는 경우, 해당 AZ에만 마운트 타겟을 생성합니다.
2. **다중 AZ 배포**: EC2 인스턴스가 여러 AZ에 분산되어 있는 경우, 각 AZ마다 마운트 타겟을 생성합니다.
3. **전체 VPC 배포**: 모든 AZ에 EC2 인스턴스가 있거나 향후 확장을 고려하는 경우, VPC의 모든 AZ에 마운트 타겟을 생성합니다.



## 4 EFS 배포 시나리오

### 4.1 단일 AZ 배포

- **시나리오**: 모든 EC2 인스턴스가 하나의 AZ에만 있는 경우
- **솔루션**: 해당 AZ에 하나의 마운트 타겟만 생성
- **장점**: 간단한 구성, 비용 효율적
- **단점**: 해당 AZ에 장애 발생 시 전체 시스템에 영향



### 4.2 다중 AZ 배포 (권장)

- **시나리오**: EC2 인스턴스가 여러 AZ에 분산되어 있는 경우
- **솔루션**: 사용 중인 각 AZ에 마운트 타겟 생성
- **장점**:
    - 고가용성 확보
    - 각 EC2 인스턴스가 같은 AZ의 마운트 타겟을 사용하여 최저 지연 시간 확보
- **단점**: 약간의 추가 비용 발생 가능



### 4.3 전체 VPC 배포

- **시나리오**: 현재 또는 향후 모든 AZ에 EC2 인스턴스가 있을 수 있는 경우
- **솔루션**: VPC의 모든 AZ에 마운트 타겟 생성
- **장점**:
    - 최대의 유연성
    - 향후 확장에 대비
- **단점**: 사용하지 않는 AZ의 마운트 타겟에 대한 비용 발생 가능



## 5 결론

- Amazon EFS는 탄력적이고 확장 가능한 파일 스토리지 솔루션으로, 다양한 워크로드에 적합합니다.
- 마운트 타겟을 통해 EC2 인스턴스들이 EFS 파일 시스템에 접근할 수 있으며, 적절한 마운트 타겟 배포 전략을 선택하는 것이 중요합니다.
- 다중 AZ 배포 전략은 고가용성과 낮은 지연 시간을 동시에 제공하여 대부분의 시나리오에 적합합니다.
- EFS의 성능 모드, 처리량 모드, 스토리지 클래스 등을 워크로드에 맞게 선택하고, CloudWatch 메트릭을 통해 지속적으로 모니터링하여 최적의 성능을 얻을 수 있습니다.
## 1 AWS Cognito

- AWS Cognito는 사용자 인증, 권한 부여 및 사용자 관리 기능을 제공하는 서비스입니다.
- 이를 통해 웹 및 모바일 애플리케이션에서 간편하게 사용자 로그인과 데이터 보안을 구현할 수 있습니다.



### 1.1 주요 기능

- **사용자 풀 (Cognito User Pools)**:
    - 사용자 풀은 애플리케이션 사용자 디렉토리를 관리합니다.
    - 사용자는 이메일 주소나 전화번호로 회원 가입할 수 있으며, 관리자는 이를 통해 사용자 인증을 처리할 수 있습니다.
    - 서버리스 데이터베이스를 제공하여 웹 및 모바일 애플리케이션에서 사용자를 관리할 수 있습니다.
    - **기능**:
        - 간단한 로그인: 사용자 이름(또는 이메일)과 비밀번호 조합을 사용
        - 비밀번호 재설정
        - 이메일 및 전화번호 인증
        - 다단계 인증(MFA)
        - 연합 신원: Facebook, Google, SAML 등의 사용자
- **연합 신원 풀 (Cognito Identity Pools)**:
    - AWS 리소스에 직접 접근할 수 있도록 사용자에게 AWS 자격 증명을 제공합니다.
    - Cognito 사용자 풀을 신원 공급자로 통합할 수 있습니다.
    - **기능**:
        - 사용자에게 임시 AWS 자격 증명을 부여
        - 사용자 소스는 Cognito 사용자 풀, 타사 로그인 등 다양
        - 사용자는 AWS 서비스에 직접 접근하거나 API Gateway를 통해 접근할 수 있음
        - 자격 증명에 적용되는 IAM 정책은 Cognito에서 정의되며, 세밀한 제어를 위해 사용자 ID에 따라 맞춤화 가능
        - 인증된 사용자와 게스트 사용자에 대한 기본 IAM 역할 제공



## 2 작동 방식

- **사용자 인증**:
    - 사용자가 애플리케이션에 로그인하면 Cognito는 사용자 풀을 통해 자격 증명을 확인합니다.
    - 인증에 성공하면 JWT(JSON Web Token)를 반환하여 사용자가 애플리케이션에 접근할 수 있도록 합니다.
- **권한 부여**:
    - Cognito는 IAM 역할을 사용하여 사용자의 권한을 관리합니다.
    - 이를 통해 세밀한 접근 제어가 가능하며, 각 사용자 또는 사용자 그룹에 대해 다양한 권한을 설정할 수 있습니다.
- **연동**:
    - Cognito는 Lambda 함수를 트리거하여 사용자 가입, 로그인, 토큰 갱신 등의 이벤트에 대한 커스텀 로직을 실행할 수 있습니다.
    - 이를 통해 다양한 비즈니스 로직을 손쉽게 통합할 수 있습니다.



### 2.1 통합

- **API Gateway 및 Application Load Balancer**:
    - Cognito 사용자 풀은 API Gateway 및 Application Load Balancer와 통합됩니다.
- **서드파티 로그인**:
    - Facebook, Google, SAML 등의 서드파티 로그인을 연합 신원 풀과 통합하여 사용할 수 있습니다.



## 3 사용 사례

- **웹 및 모바일 애플리케이션**:
    - 사용자 인증 및 권한 부여를 손쉽게 구현하여 애플리케이션 보안을 강화합니다.
- **다단계 인증**:
    - 추가 보안이 필요한 애플리케이션에 다단계 인증을 적용하여 보안성을 높입니다.
- **연합 인증**:
    - 타사 자격 증명 공급자를 통한 연합 인증을 지원하여 사용자 편의성을 향상시킵니다.
- **서버리스 애플리케이션**:
    - Cognito와 Lambda를 연동하여 서버리스 애플리케이션에서 사용자 인증 및 권한 부여를 처리할 수 있습니다.



## 4 Cognito의 장점

- **안정성**:
    - AWS의 인프라를 기반으로 높은 가용성과 안정성을 제공합니다.
- **확장성**:
    - 자동으로 확장되어 수백만 명의 사용자를 처리할 수 있습니다.
- **보안**:
    - 데이터 암호화, 다단계 인증, 세밀한 접근 제어를 통해 높은 수준의 보안을 제공합니다.
- **통합성**:
    - 다양한 AWS 서비스 및 타사 애플리케이션과 손쉽게 통합할 수 있습니다.



## 5 API Gateway와의 통합

- AWS Cognito는 API Gateway와 통합하여 사용자 인증 및 권한 부여를 간편하게 구현할 수 있습니다.
- 이를 통해 API Gateway를 통해 전달되는 모든 요청을 인증하고, 적절한 권한을 부여할 수 있습니다.



### 5.1 동작 방식

- **사용자 인증**:
    - 사용자가 애플리케이션에 로그인하면, AWS Cognito 사용자 풀은 사용자 자격 증명을 확인합니다.
    - 인증에 성공하면 JWT(JSON Web Token)를 반환하여 사용자가 애플리케이션에 접근할 수 있도록 합니다.
- **JWT 토큰 사용**:
    - 사용자는 로그인 후 받은 JWT 토큰을 API 요청의 헤더에 포함시켜 API Gateway로 요청을 보냅니다.
    - API Gateway는 이 토큰을 검증하여 요청이 인증된 사용자로부터 왔는지 확인합니다.
- **권한 부여**:
    - Cognito는 사용자 풀에 정의된 권한을 기반으로 IAM 역할을 사용하여 API Gateway에서 요청을 처리할 권한을 부여합니다.
    - API Gateway는 JWT 토큰의 클레임을 확인하여 사용자가 요청한 리소스에 접근할 권한이 있는지 판단합니다.
- **정책 적용**:
    - API Gateway는 Cognito 사용자 풀과 연동하여 사용자의 그룹이나 속성에 따라 세밀한 접근 제어 정책을 적용할 수 있습니다.
    - 예를 들어, 특정 그룹에 속한 사용자만 특정 API 엔드포인트에 접근할 수 있도록 설정할 수 있습니다.



### 5.2 설정 방법

1. **Cognito 사용자 풀 생성**:
    - AWS Management Console에서 Cognito 사용자 풀을 생성하고, 사용자 인증을 위한 설정을 구성합니다.
2. **API Gateway 설정**:
    - API Gateway 콘솔에서 새로운 API를 생성하거나 기존 API를 선택합니다.
    - 인증 설정에서 'Cognito 사용자 풀'을 선택하고, 앞서 생성한 사용자 풀을 연결합니다.
3. **정책 및 권한 설정**:
    - Cognito 사용자 풀에서 사용자 그룹 및 권한을 정의합니다.
    - IAM 역할을 생성하고, 이를 Cognito 사용자 풀에 연결하여 사용자 그룹에 따른 권한을 설정합니다.
4. **토큰 검증 설정**:
    - API Gateway에서 JWT 토큰을 검증하도록 설정합니다.
    - 토큰의 유효성, 클레임, 서명 등을 검증하여 요청을 처리합니다.



### 5.3 사용 사례

- **보안 API**:
    - 민감한 데이터를 다루는 API는 Cognito와 통합하여 사용자 인증 및 권한 부여를 강화할 수 있습니다.
- **다단계 인증**:
    - 다단계 인증을 적용하여 API Gateway를 통한 요청을 더욱 안전하게 보호할 수 있습니다.
- **서드파티 통합**:
    - Facebook, Google 등의 서드파티 자격 증명 공급자를 통한 인증을 지원하여 다양한 사용자가 API에 접근할 수 있도록 합니다.
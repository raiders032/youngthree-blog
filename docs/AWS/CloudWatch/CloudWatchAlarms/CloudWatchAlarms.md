## 1 CloudWatch 알람

- CloudWatch 알람은 AWS 리소스의 상태를 모니터링하고 특정 조건이 충족될 때 알림을 트리거하는 강력한 도구입니다.
- 이를 통해 시스템 관리자는 문제를 신속하게 감지하고 대응할 수 있습니다.
- CloudWatch 알람은 다양한 AWS 서비스와 통합되어 있어 종합적인 모니터링 솔루션을 제공합니다.



### 1.1 알람 상태

- CloudWatch 알람은 세 가지 상태를 가질 수 있습니다:
	- **OK**: 메트릭이 정의된 임계값 내에 있어 정상 상태임을 나타냅니다.
	- **ALARM**: 메트릭이 정의된 임계값을 초과하거나 미달하여 문제가 발생했음을 나타냅니다.
	- **INSUFFICIENT_DATA**: 알람을 평가하기에 충분한 데이터가 수집되지 않았음을 나타냅니다.



### 1.2 알람 설정

- CloudWatch 알람을 설정할 때 다음과 같은 옵션을 지정할 수 있습니다:
	- **메트릭**: 모니터링할 특정 지표 (예: CPU 사용률, 메모리 사용량 등)
	- **임계값**: 알람을 트리거할 메트릭 값
	- **기간(Period)**: 메트릭을 평가할 시간 간격 (예: 5분, 1시간 등)
	- **평가 기간**: 알람 상태를 결정하기 위해 검사할 연속적인 기간의 수
	- **통계**: 메트릭 데이터를 집계하는 방법 (예: 평균, 최대값, 최소값 등)



### 1.3 알람 작업

- CloudWatch 알람이 트리거되면 다음과 같은 작업을 수행할 수 있습니다:
	- **EC2 인스턴스 관리**: 인스턴스를 중지, 종료, 재부팅 또는 복구할 수 있습니다.
	- **Auto Scaling 작업**: Auto Scaling 그룹의 크기를 조정할 수 있습니다.
	- **SNS 알림**: Amazon Simple Notification Service를 통해 이메일, SMS 등으로 알림을 보낼 수 있습니다.
	- **Systems Manager 자동화**: AWS Systems Manager를 통해 자동화된 작업을 실행할 수 있습니다.



## 2 EC2 인스턴스 복구

- EC2 인스턴스 복구는 하드웨어 장애나 기타 문제로 인해 인스턴스가 비정상 상태가 되었을 때 유용한 기능입니다.
- CloudWatch 알람과 연동하여 자동으로 인스턴스를 복구할 수 있습니다.



### 2.1 복구 프로세스

- EC2 인스턴스 복구 프로세스는 다음과 같이 진행됩니다
	1. CloudWatch가 인스턴스의 상태를 모니터링합니다.
	2. 설정된 조건(예: 상태 검사 실패)이 충족되면 알람이 트리거됩니다.
	3. 알람은 EC2 서비스에 복구 작업을 요청합니다.
	4. EC2 서비스는 새로운 하드웨어에 인스턴스를 재생성합니다.
	5. 인스턴스는 대부분의 구성을 유지한 채로 복구됩니다.



### 2.2 복구 후 인스턴스 특성

- 복구된 인스턴스는 다음과 같은 특성을 유지합니다:
	- 인스턴스 ID
	- 프라이빗 IP 주소
	- 퍼블릭 IP 주소
	- 탄력적 IP 주소 (연결된 경우)
	- 인스턴스 메타데이터
	- 배치 그룹



### 2.3 복구 알람 설정

- EC2 인스턴스 복구를 위한 CloudWatch 알람을 설정하는 방법은 다음과 같습니다:
	1. CloudWatch 콘솔에서 '알람 생성'을 선택합니다.
	2. EC2 인스턴스를 선택하고 'StatusCheckFailed_System' 메트릭을 선택합니다.
	3. 조건을 설정합니다 (예: 1분 동안 1회 이상 실패).
	4. 알람 작업으로 'EC2 인스턴스 복구'를 선택합니다.
	5. 필요한 경우 SNS 주제를 선택하여 알림을 받습니다.
	6. 알람 이름과 설명을 입력하고 알람을 생성합니다.



## 3 CloudWatch Insights and Operational Visibility

- CloudWatch는 단순한 모니터링 도구를 넘어 다양한 인사이트와 운영 가시성을 제공합니다.
- 이를 통해 복잡한 시스템의 성능을 종합적으로 분석하고 최적화할 수 있습니다.



### 3.1 CloudWatch Container Insights

- Container Insights는 컨테이너화된 애플리케이션과 마이크로서비스의 성능을 모니터링합니다.
- 지원되는 플랫폼:
	- Amazon Elastic Container Service (ECS)
	- Amazon Elastic Kubernetes Service (EKS)
	- Kubernetes on EC2
	- AWS Fargate
- 제공하는 메트릭:
	- CPU 사용률
	- 메모리 사용량
	- 디스크 I/O
	- 네트워크 트래픽
- 이를 통해 컨테이너 환경의 리소스 사용량을 최적화하고 문제를 신속하게 진단할 수 있습니다.



### 3.2 CloudWatch Lambda Insights

- Lambda Insights는 서버리스 애플리케이션의 성능을 모니터링하고 최적화하는 데 도움을 줍니다.
- 제공하는 정보:
	- 콜드 스타트 빈도 및 지속 시간
	- 메모리 사용량
	- 함수 실행 시간
	- 오류율 및 스로틀링
- 이를 통해 Lambda 함수의 성능을 개선하고 비용을 최적화할 수 있습니다.



### 3.3 CloudWatch Contributor Insights

- Contributor Insights는 로그 데이터를 분석하여 상위 기여자를 식별합니다.
- 사용 사례:
	- 네트워크 트래픽의 주요 소스 IP 식별
	- 가장 많은 오류를 발생시키는 URL 파악
	- 리소스 사용량이 가장 높은 사용자 확인
- 이 기능을 통해 성능 병목 현상이나 보안 위협을 신속하게 파악할 수 있습니다.



### 3.4 CloudWatch Application Insights

- Application Insights는 애플리케이션 스택 전체의 문제를 자동으로 감지하고 진단합니다.
- 주요 기능:
	- 애플리케이션 리소스와 기술 스택을 자동으로 검색
	- 지속적인 모니터링 설정
	- AI/ML을 활용한 이상 징후 감지
	- 문제 해결을 위한 권장 사항 제공
- 이를 통해 복잡한 분산 애플리케이션의 문제를 보다 효과적으로 해결할 수 있습니다.



## 4 실제 사례: CloudWatch를 이용한 EC2 인스턴스 관리

- 다음은 CloudWatch 알람을 사용하여 EC2 인스턴스의 CPU 사용률을 모니터링하고 자동으로 관리하는 실제 사례입니다.
- 이 예시는 리소스 최적화와 비용 절감을 위한 CloudWatch의 활용 방법을 보여줍니다.



### 4.1 시나리오

- 한 기업에서 다수의 EC2 인스턴스를 운영하고 있습니다.
- 일부 인스턴스의 CPU 사용률이 지속적으로 낮아 리소스가 낭비되고 있다는 것을 발견했습니다.
- SysOps 관리자는 CPU 사용률이 60분 이상 10% 미만인 인스턴스를 자동으로 종료하는 솔루션을 구현해야 합니다.



### 4.2 솔루션: CloudWatch 알람 사용

- 이 요구사항을 가장 효율적으로 충족시키는 방법은 CloudWatch 알람을 사용하는 것입니다.
- 각 EC2 인스턴스에 대해 다음과 같은 CloudWatch 알람을 설정합니다:
	  1. 모니터링할 메트릭: 평균 CPU 사용률
	  2. 기간(Period): 1시간 (60분)
	  3. 임계값: 10% 미만
	  4. 알람 작업: EC2 인스턴스 중지



### 4.3 구현 단계

- AWS Management Console에서 CloudWatch 서비스로 이동합니다.
- '알람 생성'을 선택합니다.
- EC2 인스턴스 지표를 선택하고, 'CPUUtilization' 메트릭을 선택합니다.
- 조건을 다음과 같이 설정합니다:
    - 통계: Average
    - 기간: 1시간
    - 임계값 유형: 정적
    - 조건: CPU 사용률이 10% 미만일 때
- 알람 상태 트리거를 '데이터 포인트 1/1'로 설정합니다.
- 알람 작업으로 'EC2 작업 - 인스턴스 중지'를 선택합니다.
- 알람 이름과 설명을 입력하고 알람을 생성합니다.



### 4.4 장점

- **자동화**: 수동 개입 없이 자동으로 리소스를 관리합니다.
- **비용 효율성**: 사용되지 않는 인스턴스를 종료하여 비용을 절감합니다.
- **확장성**: 모든 EC2 인스턴스에 쉽게 적용할 수 있습니다.
- **유연성**: 필요에 따라 임계값과 기간을 조정할 수 있습니다.



### 4.5 주의사항

- 중요한 프로세스가 실행 중인 인스턴스에는 이 알람을 설정하지 않도록 주의해야 합니다.
- 인스턴스 종료 전에 알림을 받도록 SNS 주제를 연결하는 것이 좋습니다.
- 정기적으로 알람 설정을 검토하고 필요에 따라 조정해야 합니다.



## 5 결론

- CloudWatch 알람과 EC2 인스턴스 복구 기능은 AWS 환경의 안정성과 가용성을 크게 향상시킵니다.
- 자동화된 모니터링과 복구 프로세스를 통해 시스템 관리자의 부담을 줄이고 서비스 중단 시간을 최소화할 수 있습니다.
- CloudWatch의 다양한 Insights 기능을 활용하면 복잡한 시스템의 성능을 종합적으로 분석하고 최적화할 수 있습니다.
- 이러한 도구들을 효과적으로 활용하여 안정적이고 효율적인 AWS 인프라를 구축하고 운영할 수 있습니다.
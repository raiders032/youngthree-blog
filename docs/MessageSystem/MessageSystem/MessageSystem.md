---
title: "Message System"
description: "분산 시스템에서 핵심적인 역할을 하는 메시징 시스템의 개념과 작동 원리를 상세히 알아봅니다. 큐잉과 발행-구독 모델의 차이점, 메시지 브로커의 역할, 그리고 실제 현업에서 사용되는 다양한 메시징 시스템 솔루션을 소개합니다."
tags: [ "MESSAGE_QUEUE", "DISTRIBUTED_SYSTEM", "BACKEND", "ARCHITECTURE", "SYSTEM_DESIGN" ]
keywords: [ "메시징시스템", "messaging system", "메시지큐", "message queue", "발행구독", "publish subscribe", "pub sub", "메시지브로커", "message broker", "분산시스템", "distributed system", "카프카", "kafka", "래빗엠큐", "rabbitmq" ]
draft: false
hide_title: true
---

## 1. 메시징 시스템 소개

- 분산 시스템에서 가장 큰 도전 과제 중 하나는 여러 소스에서 발생하는 지속적인 데이터 흐름을 관리하는 것입니다.
- 이러한 문제를 효과적으로 해결하기 위해 메시징 시스템이 도입되었습니다.

### 1.1 메시징 시스템이란?

- 메시징 시스템은 서비스, 애플리케이션, 프로세스 또는 서버 간의 데이터 전송을 담당하는 중간 계층입니다.
- 이 시스템은 발신자와 수신자 사이에 비동기 방식의 데이터 전송을 제공함으로써 분산 시스템의 다양한 구성 요소를 효과적으로 분리합니다.

### 1.2 메시지의 정의와 특성

- 메시지는 시스템 간에 전달되는 데이터의 기본 단위입니다.
- 메시지는 헤더(메타데이터)와 본문(실제 데이터)으로 구성됩니다.
- 메시지는 자체 완결적이며, 수신자가 처리하는 데 필요한 모든 정보를 포함해야 합니다.

### 1.3 메시지의 종류

#### 문서(Document)

- 순수한 데이터를 포함하는 메시지
- 시스템 간의 데이터 전송에 사용
- 예: 주문 정보, 고객 데이터

#### 커맨드(Command)

- 수신자가 특정 동작을 수행하도록 지시하는 메시지
- RPC(원격 프로시저 호출)와 유사한 패턴
- 예: "주문 취소", "결제 처리"

#### 이벤트(Event)

- 시스템에서 발생한 상태 변경을 알리는 메시지
- 과거 시제로 표현되는 것이 일반적
- 예: "주문 완료됨", "배송 시작됨"

## 2. 메시징 시스템의 핵심 모델

### 2.1 큐잉(Queuing) 모델

- 큐잉 모델에서는 메시지가 큐에 순차적으로 저장됩니다.
- 프로듀서가 메시지를 큐에 끝에 추가하고, 컨슈머가 큐의 앞에서 메시지를 추출합니다.
  - 선입선출(FIFO) 방식으로 동작합니다.
- 하나의 메시지는 최대 하나의 컨슈머에 의해 처리됩니다.
- 컨슈머가 메시지를 가져가면 큐에서 삭제됩니다.
- 메시지 처리를 여러 소비자에게 효과적으로 분산할 수 있어 로드 밸런싱에 적합합니다.
- 그러나 다수의 컨슈머가 동일한 메시지를 읽을 수 없다는 한계가 있습니다.
  - 이런 경우 발행-구독 모델을 사용합니다.

### 2.2 발행-구독(Publish-Subscribe) 모델

- 발행 구독 모델에서는 메시지가 토픽에 발행됩니다.
- 발행자는 특정 토픽에 메시지를 발행합니다.
- 구독자는 관심 있는 토픽을 구독하여 모든 메시지 수신합니다.
- 여러 소비자가 동일한 메시지를 받을 수 있습니다.
- 큐잉 모델과 다르게 다수의 컨슈머가 동일한 메시지를 읽을 수 있습니다.

:::info[발행-구독 모델의 특징]
실시간 이벤트 처리나 브로드캐스트 형태의 메시지 전달에 적합합니다.
:::

### 2.3 비동기 요청/응답 패턴

- 전통적인 동기식 요청/응답과 달리 즉각적인 응답을 기다리지 않음
- 응답을 위한 별도의 콜백 채널이나 상관 ID 사용
- 장점
	- 시스템 간 결합도 감소
	- 높은 확장성과 유연성
	- 일시적인 장애 상황에 강인
- 단점
	- 구현 복잡도 증가
	- 디버깅과 추적이 어려움

## 3. 메시지 브로커의 역할과 특성

### 3.1 메시지 브로커의 정의

- 메시지 브로커는 발신자와 수신자 사이의 중개자 역할을 수행하는 미들웨어입니다.
- 메시지의 수신, 저장, 라우팅, 전달을 담당합니다.
- 시스템 간의 느슨한 결합을 가능하게 합니다.

### 3.2 브로커 검토 시 고려사항

#### 기술적 요구사항

- 프로그래밍 언어 지원 여부
- 메시지 순서 보장 수준
- 메시지 전달 보장 수준
- 데이터 영속화 기능
- 시스템 내구성
- 수평적/수직적 확장성
- 메시지 처리 지연시간
- 경쟁 소비자 패턴 지원

#### 운영적 요구사항

- 모니터링 및 관리 도구
- 클러스터링 지원
- 보안 기능
- 백업 및 복구 기능

### 3.3 브로커 기반 메시징의 장단점

#### 장점

- 시스템 간 느슨한 결합 달성
- 효과적인 메시지 버퍼링
- 시스템 부하 조절 가능
- 메시지 영속성 보장
- 다양한 통신 패턴 지원

#### 단점

- 잠재적인 성능 병목 지점
- 단일 장애점이 될 수 있음
- 운영 복잡도 증가
- 추가적인 인프라 비용
- 디버깅과 모니터링의 어려움

## 4. 메시지 처리의 신뢰성

### 4.1 중복 메시지 처리

- 메시지 브로커가 각 메시지를 꼭 한 번만 전달하면 좋겠지만 그만큼 값비싼 대가를 치뤄야 합니다.
- 그래서 일반적으로 메시지 브로커는 적어도 한 번 이상 메시지를 전달하겠다 약속합니다.
- `적어도 한 번 절달`을 보장하는 메시지 브로커는 시스템이 정상일 때 각 메시지를 한 번만 전달합니다.
  - 그러나 클라이언트나 브로커 자신이 실패할 경우 메시지를 여러 번 전달할 수 있습니다.
  - 클라이언트가 메시지를 처리하고 DB 업데이트를 마친 후 메시지를 ACK하기 전에 갑자기 멎었다고 합니다.
  - 크라이언트가 재시동하면 메시지 브로커는 ACK 되지 않은 메시지를 다시 전달합니다.
- 중복 메시지를 처리하는 방법은 멱등한 메시지 핸들러를 작성하는 것 입니다.

### 4.2 멱등한 메시지 핸들러

- 멱등성이란 동일한 메시지를 여러 번 처리해도 결과가 같은 특성입니다.
- 애플리케이션 메시지 처리 로직이 멱등하면 중복 메시지는 무해해집니다.
- 구현 방법:
	- 메시지 ID를 이용한 중복 체크
	- 트랜잭션 상태 관리
	- 조건부 업데이트 사용
	- 버전 관리 시스템 도입

:::warning[멱등성 구현 시 주의사항]
멱등성을 보장하기 위해서는 메시지 처리의 모든 단계가 멱등해야 합니다.
:::

## 5. 주요 메시징 시스템 솔루션

### 5.1 Apache Kafka

- 높은 처리량과 확장성
- 실시간 스트리밍 데이터 처리에 최적화
- 메시지 영속성과 복제 기능
- Consumer Group을 통한 유연한 메시지 소비 패턴 지원
- LinkedIn에서 개발하여 빅데이터 처리에 널리 사용

### 5.2 RabbitMQ

- AMQP 프로토콜 지원
- 유연한 라우팅 기능
- 클러스터링과 고가용성 제공
- 전통적인 메시지 큐잉에 적합
- 다양한 메시지 처리 패턴 지원 (Competing Consumers, Message Fanout 등)

### 5.3 Apache ActiveMQ

- JMS 표준 완벽 지원
- 다양한 프로토콜 지원
- 엔터프라이즈 통합에 적합
- Spring Framework와의 높은 호환성

### 5.4 Redis Pub/Sub

- 인메모리 데이터 구조로 고성능
- 간단한 구현과 빠른 처리
- 실시간 메시징에 적합
- 영속성이 중요하지 않은 경우에 사용

:::warning[솔루션 선택 시 고려사항]
메시징 시스템 선택 시에는 처리량, 지연 시간, 신뢰성, 확장성 등 프로젝트의 요구사항을 면밀히 검토해야 합니다.
:::

## 6. 결론

- 메시징 시스템은 현대 분산 시스템의 핵심 구성 요소로, 시스템 간의 효율적인 통신과 안정적인 데이터 처리를 가능하게 합니다.
- 적절한 메시징 시스템의 선택과 구현은 시스템의 확장성, 신뢰성, 그리고 전반적인 성능에 큰 영향을 미칩니다.
- 메시지의 신뢰성 있는 처리와 멱등성 보장은 시스템 설계 시 반드시 고려해야 할 핵심 요소입니다.